<!doctypehtml><html lang=fr><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>StudyAI - Gestion d'Apprentissage Intelligente</title><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css rel=stylesheet><style>:root{--primary:#3B82F6;--primary-dark:#2563EB;--primary-light:#93C5FD;--secondary:#10B981;--secondary-dark:#059669;--secondary-light:#6EE7B7;--accent:#F59E0B;--accent-dark:#D97706;--accent-light:#FCD34D;--success:#10B981;--warning:#F59E0B;--danger:#EF4444;--info:#3B82F6;--white:#FFFFFF;--gray-50:#F9FAFB;--gray-100:#F3F4F6;--gray-200:#E5E7EB;--gray-300:#D1D5DB;--gray-400:#9CA3AF;--gray-500:#6B7280;--gray-600:#4B5563;--gray-700:#374151;--gray-800:#1F2937;--gray-900:#111827;--font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;--font-size-xs:0.75rem;--font-size-sm:0.875rem;--font-size-base:1rem;--font-size-lg:1.125rem;--font-size-xl:1.25rem;--font-size-2xl:1.5rem;--font-size-3xl:1.875rem;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--shadow-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--shadow-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--shadow-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--radius-sm:0.25rem;--radius:0.5rem;--radius-md:0.75rem;--radius-lg:1rem;--radius-full:9999px;--transition:all 0.2s ease-in-out;--transition-slow:all 0.3s ease-in-out}*{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-family);font-size:var(--font-size-base);line-height:1.5;color:var(--gray-700);background-color:var(--gray-50);overflow-x:hidden}h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1.2;color:var(--gray-800)}h1{font-size:var(--font-size-3xl)}h2{font-size:var(--font-size-2xl)}h3{font-size:var(--font-size-xl)}h4{font-size:var(--font-size-lg)}.auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary) 0,var(--secondary) 100%);padding:var(--spacing-4)}.auth-container{background:var(--white);padding:var(--spacing-8);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);width:100%;max-width:400px;animation:slideIn .5s ease-out}@keyframes slideIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.auth-header{text-align:center;margin-bottom:var(--spacing-6)}.auth-title{font-size:var(--font-size-2xl);color:var(--primary);margin-bottom:var(--spacing-2);display:flex;align-items:center;justify-content:center;gap:var(--spacing-2)}.auth-subtitle{color:var(--gray-600);font-size:var(--font-size-sm)}.auth-tabs{display:flex;margin-bottom:var(--spacing-6);background:var(--gray-100);border-radius:var(--radius);padding:var(--spacing-1)}.auth-tab{flex:1;padding:var(--spacing-3);background:0 0;border:none;border-radius:var(--radius-sm);cursor:pointer;transition:var(--transition);font-weight:500}.auth-tab.active{background:var(--white);color:var(--primary);box-shadow:var(--shadow-sm)}.auth-form{display:none}.auth-form.active{display:block}.input-group{position:relative;margin-bottom:var(--spacing-4)}.input-group i{position:absolute;left:var(--spacing-3);top:50%;transform:translateY(-50%);color:var(--gray-400)}.input-group input,.input-group select{width:100%;padding:var(--spacing-3) var(--spacing-10);border:2px solid var(--gray-200);border-radius:var(--radius);font-size:var(--font-size-base);transition:var(--transition);background:var(--white)}.input-group input:focus,.input-group select:focus{outline:0;border-color:var(--primary);box-shadow:0 0 0 3px rgba(59,130,246,.1)}.auth-btn{width:100%;padding:var(--spacing-4);border:none;border-radius:var(--radius);font-size:var(--font-size-base);font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:var(--spacing-2)}.auth-btn.primary{background:var(--primary);color:var(--white)}.auth-btn.primary:hover{background:var(--primary-dark);transform:translateY(-1px)}.app{display:flex;min-height:100vh}.sidebar{width:280px;background:var(--white);border-right:1px solid var(--gray-200);display:flex;flex-direction:column;position:fixed;left:0;top:0;height:100vh;z-index:1000;box-shadow:var(--shadow)}.sidebar-header{padding:var(--spacing-6);border-bottom:1px solid var(--gray-200)}.sidebar-title{font-size:var(--font-size-xl);color:var(--primary);margin-bottom:var(--spacing-4);display:flex;align-items:center;gap:var(--spacing-2)}.user-info{display:flex;align-items:center;gap:var(--spacing-3)}.user-avatar{width:40px;height:40px;background:var(--primary-light);border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;color:var(--primary)}.user-details{display:flex;flex-direction:column}.user-name{font-weight:600;color:var(--gray-800)}.user-level{font-size:var(--font-size-sm);color:var(--gray-500)}.sidebar-nav{flex:1;padding:var(--spacing-4);list-style:none}.nav-item{display:flex;align-items:center;gap:var(--spacing-3);padding:var(--spacing-3) var(--spacing-4);border-radius:var(--radius);cursor:pointer;transition:var(--transition);margin-bottom:var(--spacing-1)}.nav-item:hover{background:var(--gray-100)}.nav-item.active{background:var(--primary);color:var(--white)}.sidebar-footer{padding:var(--spacing-4);border-top:1px solid var(--gray-200)}.logout-btn{width:100%;padding:var(--spacing-3);background:0 0;border:1px solid var(--gray-300);border-radius:var(--radius);cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:var(--spacing-2);color:var(--gray-600)}.logout-btn:hover{background:var(--danger);color:var(--white);border-color:var(--danger)}.main-content{flex:1;margin-left:280px;padding:var(--spacing-6);min-height:100vh}.section{display:none}.section.active{display:block}.section-header{display:flex;align-items:center;justify-content:between;margin-bottom:var(--spacing-6);flex-wrap:wrap;gap:var(--spacing-4)}.section-header h1{flex:1}.header-actions{display:flex;align-items:center;gap:var(--spacing-4)}.btn{padding:var(--spacing-3) var(--spacing-5);border:none;border-radius:var(--radius);font-size:var(--font-size-sm);font-weight:600;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:var(--spacing-2);text-decoration:none;white-space:nowrap}.btn:hover{transform:translateY(-1px)}.btn.primary{background:var(--primary);color:var(--white)}.btn.primary:hover{background:var(--primary-dark)}.btn.secondary{background:var(--gray-100);color:var(--gray-700);border:1px solid var(--gray-300)}.btn.secondary:hover{background:var(--gray-200)}.btn.danger{background:var(--danger);color:var(--white)}.btn.danger:hover{background:#dc2626}.card{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:var(--spacing-6);transition:var(--transition)}.card:hover{box-shadow:var(--shadow-md)}.card-header{display:flex;align-items:center;justify-content:between;margin-bottom:var(--spacing-4)}.card-header h3{flex:1}.card-header i{color:var(--primary);font-size:var(--font-size-xl)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:2000;animation:fadeIn .3s ease-out}.modal.active{display:flex;align-items:center;justify-content:center}.modal-content{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);width:90%;max-width:500px;max-height:90vh;overflow-y:auto;animation:slideIn .3s ease-out}.modal-header{display:flex;align-items:center;justify-content:between;padding:var(--spacing-6);border-bottom:1px solid var(--gray-200)}.modal-header h2{flex:1}.close-btn{background:0 0;border:none;font-size:var(--font-size-xl);cursor:pointer;color:var(--gray-400);transition:var(--transition)}.close-btn:hover{color:var(--gray-600)}.modal-body{padding:var(--spacing-6)}.modal-footer{display:flex;gap:var(--spacing-3);padding:var(--spacing-6);border-top:1px solid var(--gray-200);justify-content:flex-end}.notification-toast{position:fixed;top:var(--spacing-6);right:var(--spacing-6);background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:var(--spacing-4);display:flex;align-items:center;gap:var(--spacing-3);z-index:3000;transform:translateX(100%);transition:var(--transition);min-width:300px}.notification-toast.show{transform:translateX(0)}.toast-content{display:flex;align-items:center;gap:var(--spacing-3);flex:1}.toast-icon{font-size:var(--font-size-lg)}.toast-close{background:0 0;border:none;color:var(--gray-400);cursor:pointer;font-size:var(--font-size-sm)}.notification-toast.success .toast-icon{color:var(--success)}.notification-toast.error .toast-icon{color:var(--danger)}.notification-toast.info .toast-icon{color:var(--info)}.notification-toast.warning .toast-icon{color:var(--warning)}.loading-spinner{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.9);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:4000}.loading-spinner.active{display:flex}.spinner{width:40px;height:40px;border:4px solid var(--gray-200);border-top:4px solid var(--primary);border-radius:var(--radius-full);animation:spin 1s linear infinite;margin-bottom:var(--spacing-4)}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.no-data{text-align:center;color:var(--gray-500);font-style:italic;padding:var(--spacing-8)}.text-center{text-align:center}.hidden{display:none!important}@media (max-width:768px){.sidebar{width:100%;transform:translateX(-100%);transition:var(--transition)}.sidebar.open{transform:translateX(0)}.main-content{margin-left:0;padding:var(--spacing-4)}.section-header{flex-direction:column;align-items:stretch}.auth-container{padding:var(--spacing-6)}.modal-content{width:95%;margin:var(--spacing-4)}.notification-toast{right:var(--spacing-4);left:var(--spacing-4);min-width:auto}}.switch{position:relative;display:inline-block;width:48px;height:24px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--gray-300);transition:var(--transition);border-radius:var(--radius-full)}.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:var(--transition);border-radius:var(--radius-full)}input:checked+.slider{background-color:var(--primary)}input:checked+.slider:before{transform:translateX(24px)}.progress-bar{width:100%;height:8px;background:var(--gray-200);border-radius:var(--radius-full);overflow:hidden}.success-percentage{text-align:center}.percentage-circle{width:80px;height:80px;border-radius:var(--radius-full);background:conic-gradient(var(--primary) 0deg,var(--gray-200) 0deg);display:flex;align-items:center;justify-content:center;margin:0 auto var(--spacing-2);position:relative;transition:var(--transition-slow)}.percentage-circle::before{content:'';position:absolute;width:60px;height:60px;background:var(--white);border-radius:var(--radius-full)}.percentage-text{position:relative;z-index:1;font-weight:700;font-size:var(--font-size-lg);color:var(--primary)}.percentage-label{font-size:var(--font-size-xs);color:var(--gray-500);text-align:center}.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-6)}.dashboard-card{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:var(--spacing-6);transition:var(--transition);border-left:4px solid transparent}.dashboard-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}.stats-card{border-left-color:var(--primary)}.progress-card{border-left-color:var(--secondary)}.weak-subjects-card{border-left-color:var(--warning)}.ai-suggestions-card{border-left-color:var(--accent)}.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--spacing-4)}.stat-item{text-align:center;padding:var(--spacing-3);border-radius:var(--radius);background:var(--gray-50)}.stat-value{display:block;font-size:var(--font-size-2xl);font-weight:700;color:var(--primary);margin-bottom:var(--spacing-1)}.stat-label{font-size:var(--font-size-sm);color:var(--gray-600)}.progress-content{text-align:center}.progress-text{display:block;margin-top:var(--spacing-3);font-size:var(--font-size-sm);color:var(--gray-600)}.weak-subjects{max-height:200px;overflow-y:auto}.weak-subject-item{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-3);border-radius:var(--radius);background:var(--gray-50);margin-bottom:var(--spacing-2)}.subject-name{font-weight:600;color:var(--gray-700)}.subject-score{background:var(--warning);color:var(--white);padding:var(--spacing-1) var(--spacing-3);border-radius:var(--radius-full);font-size:var(--font-size-sm);font-weight:600}.ai-suggestions{max-height:200px;overflow-y:auto}.ai-suggestion-item{padding:var(--spacing-3);border-radius:var(--radius);background:var(--gray-50);margin-bottom:var(--spacing-2);border-left:3px solid var(--accent)}.suggestion-text{font-size:var(--font-size-sm);color:var(--gray-700);line-height:1.6}.dashboard-card{animation:cardSlideIn .6s ease-out}.dashboard-card:first-child{animation-delay:.1s}.dashboard-card:nth-child(2){animation-delay:.2s}.dashboard-card:nth-child(3){animation-delay:.3s}.dashboard-card:nth-child(4){animation-delay:.4s}@keyframes cardSlideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width:768px){.dashboard-grid{grid-template-columns:1fr;gap:var(--spacing-4)}.stats-grid{grid-template-columns:1fr;gap:var(--spacing-3)}.percentage-circle{width:60px;height:60px}.percentage-circle::before{width:45px;height:45px}.percentage-text{font-size:var(--font-size-base)}}.dashboard-notification{background:var(--info);color:var(--white);padding:var(--spacing-4);border-radius:var(--radius);margin-bottom:var(--spacing-4);display:flex;align-items:center;gap:var(--spacing-3);animation:slideInDown .5s ease-out}@keyframes slideInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.dashboard-notification.warning{background:var(--warning)}.courses-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--spacing-6)}.course-card{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow);overflow:hidden;transition:var(--transition);border:1px solid var(--gray-200)}.course-card:hover{box-shadow:var(--shadow-md);transform:translateY(-4px);border-color:var(--primary)}.course-header{padding:var(--spacing-5);background:linear-gradient(135deg,var(--primary),var(--secondary));color:var(--white);position:relative}.course-title{font-size:var(--font-size-lg);font-weight:600;margin-bottom:var(--spacing-2)}.course-meta{font-size:var(--font-size-sm);opacity:.9;display:flex;align-items:center;gap:var(--spacing-3)}.course-body{padding:var(--spacing-5)}.course-stats{display:flex;justify-content:space-between;margin-bottom:var(--spacing-4);font-size:var(--font-size-sm);color:var(--gray-600)}.course-actions{display:flex;gap:var(--spacing-2);flex-wrap:wrap}.course-actions .btn{flex:1;min-width:120px;font-size:var(--font-size-sm);padding:var(--spacing-2) var(--spacing-3)}.study-modal{max-width:1200px;width:95%}.study-content{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-6);max-height:70vh}.course-original{border-right:1px solid var(--gray-200);padding-right:var(--spacing-6)}.course-summary{padding-left:var(--spacing-6)}.content-section{margin-bottom:var(--spacing-6)}.content-section h3{color:var(--primary);margin-bottom:var(--spacing-3);padding-bottom:var(--spacing-2);border-bottom:2px solid var(--primary-light)}.content-text{max-height:300px;overflow-y:auto;padding:var(--spacing-4);background:var(--gray-50);border-radius:var(--radius);line-height:1.7;font-size:var(--font-size-sm)}.questions-container{margin-top:var(--spacing-6)}.question-item{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius);padding:var(--spacing-4);margin-bottom:var(--spacing-4);transition:var(--transition)}.question-item:hover{border-color:var(--primary);box-shadow:var(--shadow-sm)}.question-text{font-weight:600;margin-bottom:var(--spacing-3);color:var(--gray-800)}.question-options{display:flex;flex-direction:column;gap:var(--spacing-2)}.option-item{display:flex;align-items:center;gap:var(--spacing-2);padding:var(--spacing-2);border-radius:var(--radius-sm);transition:var(--transition);cursor:pointer}.option-item:hover{background:var(--gray-50)}.option-item input[type=radio]{accent-color:var(--primary)}.option-item.correct{background:var(--success);color:var(--white)}.option-item.incorrect{background:var(--danger);color:var(--white)}.question-actions{display:flex;justify-content:center;gap:var(--spacing-4);margin-top:var(--spacing-6);padding-top:var(--spacing-6);border-top:1px solid var(--gray-200)}.score-display{text-align:center;padding:var(--spacing-6);background:var(--primary-light);border-radius:var(--radius);margin-top:var(--spacing-4)}.score-value{font-size:var(--font-size-3xl);font-weight:700;color:var(--primary);display:block;margin-bottom:var(--spacing-2)}.score-label{color:var(--gray-700);font-weight:600}.score-feedback{margin-top:var(--spacing-4);padding:var(--spacing-4);background:var(--white);border-radius:var(--radius);border-left:4px solid var(--primary)}.chapter-selector{margin-bottom:var(--spacing-6)}.chapter-selector select{width:100%;padding:var(--spacing-3);border:2px solid var(--gray-200);border-radius:var(--radius);background:var(--white);font-size:var(--font-size-base);transition:var(--transition)}.chapter-selector select:focus{outline:0;border-color:var(--primary);box-shadow:0 0 0 3px rgba(59,130,246,.1)}.progress-indicator{display:flex;align-items:center;gap:var(--spacing-2);margin-bottom:var(--spacing-4);font-size:var(--font-size-sm);color:var(--gray-600)}.progress-dots{display:flex;gap:var(--spacing-1)}.progress-dot{width:8px;height:8px;border-radius:var(--radius-full);background:var(--gray-300);transition:var(--transition)}.progress-dot.active{background:var(--primary)}.progress-dot.completed{background:var(--success)}.file-upload-area{border:2px dashed var(--gray-300);border-radius:var(--radius);padding:var(--spacing-8);text-align:center;transition:var(--transition);cursor:pointer}.file-upload-area:hover{border-color:var(--primary);background:var(--primary-light)}.file-upload-area.dragover{border-color:var(--primary);background:var(--primary-light);transform:scale(1.02)}.upload-icon{font-size:var(--font-size-3xl);color:var(--gray-400);margin-bottom:var(--spacing-4)}.upload-text{color:var(--gray-600);font-size:var(--font-size-lg);margin-bottom:var(--spacing-2)}.upload-hint{color:var(--gray-500);font-size:var(--font-size-sm)}@media (max-width:768px){.courses-grid{grid-template-columns:1fr;gap:var(--spacing-4)}.study-content{grid-template-columns:1fr;gap:var(--spacing-4)}.course-original{border-right:none;border-bottom:1px solid var(--gray-200);padding-right:0;padding-bottom:var(--spacing-4)}.course-summary{padding-left:0;padding-top:var(--spacing-4)}.course-actions{flex-direction:column}.course-actions .btn{min-width:auto}}.course-status{position:absolute;top:var(--spacing-3);right:var(--spacing-3);padding:var(--spacing-1) var(--spacing-3);border-radius:var(--radius-full);font-size:var(--font-size-xs);font-weight:600}.course-status.new{background:var(--info);color:var(--white)}.course-status.in-progress{background:var(--warning);color:var(--white)}.course-status.completed{background:var(--success);color:var(--white)}.question-item.new{animation:questionAppear .5s ease-out}@keyframes questionAppear{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.dashboard-notification.success{background:var(--success)}.dashboard-notification i{font-size:var(--font-size-lg)}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--secondary));transition:width .5s ease-out}</style><div id=auth-screen class=auth-screen><div class=auth-container><div class=auth-header><h1 class=auth-title><i class="fas fa-graduation-cap"></i>StudyAI</h1><p class=auth-subtitle>Votre assistant d'apprentissage intelligent</div><div class=auth-tabs><button class="auth-tab active"data-tab=login>Connexion</button><button class=auth-tab data-tab=register>Inscription</button></div><div id=login-form class="auth-form active"><div class=input-group><i class="fas fa-envelope"></i><input type=email id=login-email placeholder="Adresse email"required></div><div class=input-group><i class="fas fa-lock"></i><input type=password id=login-password placeholder="Mot de passe"required></div><button type=submit class="auth-btn primary"onclick=handleLogin()><i class="fas fa-sign-in-alt"></i>Se connecter</button></div><div id=register-form class=auth-form><div class=input-group><i class="fas fa-user"></i><input id=register-name placeholder="Nom complet"required></div><div class=input-group><i class="fas fa-envelope"></i><input type=email id=register-email placeholder="Adresse email"required></div><div class=input-group><i class="fas fa-lock"></i><input type=password id=register-password placeholder="Mot de passe"required></div><div class=input-group><i class="fas fa-graduation-cap"></i><select id=register-level required><option value="">Choisir votre niveau<option value=L2>Licence 2 - Génie Logiciel<option value=L3>Licence 3 - Génie Logiciel<option value=M1>Master 1 - Génie Logiciel<option value=M2>Master 2 - Génie Logiciel</select></div><button type=submit class="auth-btn primary"onclick=handleRegister()><i class="fas fa-user-plus"></i>S'inscrire</button></div></div></div><div id=app class=app style=display:none><nav class=sidebar><div class=sidebar-header><h2 class=sidebar-title><i class="fas fa-graduation-cap"></i>StudyAI</h2><div class=user-info><div class=user-avatar><i class="fas fa-user"></i></div><div class=user-details><span class=user-name id=user-name>Étudiant</span><span class=user-level id=user-level>L2 - Génie Logiciel</span></div></div></div><ul class=sidebar-nav><li class="nav-item active"data-section=dashboard><i class="fas fa-tachometer-alt"></i><span>Tableau de bord</span><li class=nav-item data-section=courses><i class="fas fa-book"></i><span>Mes cours</span><li class=nav-item data-section=chat><i class="fas fa-robot"></i><span>Chat éducatif</span><li class=nav-item data-section=schedule><i class="fas fa-calendar-alt"></i><span>Planning</span><li class=nav-item data-section=exams><i class="fas fa-clipboard-check"></i><span>Évaluations</span><li class=nav-item data-section=social><i class="fas fa-users"></i><span>Social</span><li class=nav-item data-section=settings><i class="fas fa-cog"></i><span>Paramètres</span></ul><div class=sidebar-footer><button class=logout-btn onclick=handleLogout()><i class="fas fa-sign-out-alt"></i>Déconnexion</button></div></nav><main class=main-content><section id=dashboard-section class="section active"><div class=section-header><h1>Tableau de bord</h1><div class=header-actions><div class=success-percentage><div class=percentage-circle><span class=percentage-text id=success-percentage>0%</span></div><span class=percentage-label>Taux de réussite estimé</span></div></div></div><div class=dashboard-grid><div class="dashboard-card stats-card"><div class=card-header><h3>Statistiques</h3><i class="fas fa-chart-bar"></i></div><div class=stats-grid><div class=stat-item><span class=stat-value id=total-courses>0</span><span class=stat-label>Cours ajoutés</span></div><div class=stat-item><span class=stat-value id=sessions-completed>0</span><span class=stat-label>Sessions terminées</span></div><div class=stat-item><span class=stat-value id=average-score>0</span><span class=stat-label>Note moyenne</span></div><div class=stat-item><span class=stat-value id=study-streak>0</span><span class=stat-label>Jours consécutifs</span></div></div></div><div class="dashboard-card progress-card"><div class=card-header><h3>Progrès hebdomadaire</h3><i class="fas fa-progress"></i></div><div class=progress-content><div class=progress-bar><div class=progress-fill id=weekly-progress style=width:0%></div></div><span class=progress-text id=progress-text>0% de la semaine complétée</span></div></div><div class="dashboard-card weak-subjects-card"><div class=card-header><h3>Matières à améliorer</h3><i class="fas fa-exclamation-triangle"></i></div><div class=weak-subjects id=weak-subjects><p class=no-data>Aucune donnée disponible</div></div><div class="dashboard-card ai-suggestions-card"><div class=card-header><h3>Suggestions IA</h3><i class="fas fa-lightbulb"></i></div><div class=ai-suggestions id=ai-suggestions><p class=no-data>Ajoutez des cours pour recevoir des suggestions</div></div></div></section><section id=courses-section class=section><div class=section-header><h1>Mes cours</h1><button class="btn primary"onclick=openAddCourseModal()><i class="fas fa-plus"></i>Ajouter un cours</button></div><div class=courses-grid id=courses-grid><p class=no-data>Aucun cours ajouté. Commencez par ajouter votre premier cours !</div></section><section id=chat-section class=section><div class=section-header><h1>Chat éducatif IA</h1><div class=subject-selector><select id=chat-subject onchange=changeChatSubject()><option value="">Choisir une matière<option value=programmation>Programmation<option value=algorithmique>Algorithmique<option value=bases-donnees>Bases de données<option value=genie-logiciel>Génie logiciel<option value=reseaux>Réseaux<option value=securite>Sécurité informatique<option value=ia>Intelligence artificielle<option value=web>Développement web</select></div></div><div class=chat-container><div class=chat-messages id=chat-messages><div class=ai-message><div class=message-avatar><i class="fas fa-robot"></i></div><div class=message-content><p>Bonjour ! Je suis votre assistant éducatif IA. Choisissez une matière ci-dessus et posez-moi vos questions. Je suis là pour vous aider à comprendre et apprendre !</div></div></div><div class=chat-input-container><div class=chat-input-wrapper><input id=chat-input placeholder="Tapez votre question..."disabled><button id=image-upload-btn class=image-btn onclick=uploadImage()><i class="fas fa-image"></i></button><input type=file id=image-input accept=image/* style=display:none><button id=send-message-btn class=send-btn onclick=sendMessage() disabled><i class="fas fa-paper-plane"></i></button></div></div></div></section><section id=schedule-section class=section><div class=section-header><h1>Planning intelligent</h1><button class="btn primary"onclick=generateWeeklySchedule()><i class="fas fa-magic"></i>Générer nouveau planning</button></div><div class=schedule-container><div class=schedule-grid id=schedule-grid><p class=no-data>Cliquez sur "Générer nouveau planning" pour créer votre planning de la semaine</div></div></section><section id=exams-section class=section><div class=section-header><h1>Évaluations et examens</h1><button class="btn primary"onclick=createMockExam()><i class="fas fa-clipboard-list"></i>Examen blanc</button></div><div class=exams-content><div class=exam-announcement><h3>Prochaine évaluation ?</h3><p>Dites-moi si vous avez une évaluation demain et je génèrerai un examen blanc basé sur vos cours étudiés.<div class=exam-input><input id=exam-subject placeholder="Matière de l'évaluation (ex: Programmation)"> <input type=date id=exam-date><button class="btn secondary"onclick=announceExam()>Annoncer évaluation</button></div></div><div class=exams-history id=exams-history><h3>Historique des examens</h3><p class=no-data>Aucun examen effectué</div></div></section><section id=social-section class=section><div class=section-header><h1>Espace social</h1><div class=social-tabs><button class="social-tab active"data-tab=friends>Amis</button><button class=social-tab data-tab=users>Utilisateurs</button><button class=social-tab data-tab=invitations>Invitations</button></div></div><div class=social-content><div id=friends-tab class="social-tab-content active"><div class=friends-list id=friends-list><p class=no-data>Aucun ami ajouté. Envoyez des invitations pour étudier ensemble !</div></div><div id=users-tab class=social-tab-content><div class=users-search><input id=user-search placeholder="Rechercher un utilisateur..."><button class="btn secondary"onclick=searchUsers()><i class="fas fa-search"></i></button></div><div class=users-list id=users-list><p class=no-data>Utilisez la recherche pour trouver d'autres étudiants</div></div><div id=invitations-tab class=social-tab-content><div class=invitations-list id=invitations-list><p class=no-data>Aucune invitation en attente</div></div></div></section><section id=settings-section class=section><div class=section-header><h1>Paramètres</h1></div><div class=settings-content><div class=settings-card><h3>Notifications</h3><div class=setting-item><label class=switch><input type=checkbox id=study-notifications checked><span class=slider></span></label><span>Rappels d'étude (10 min avant)</span></div><div class=setting-item><label class=switch><input type=checkbox id=ai-suggestions checked><span class=slider></span></label><span>Suggestions IA quotidiennes</span></div></div><div class=settings-card><h3>Données</h3><button class="btn danger"onclick=clearAllData()><i class="fas fa-trash"></i>Effacer toutes les données</button><p class=settings-note>Cette action est irréversible</div></div></section></main></div><div id=add-course-modal class=modal><div class=modal-content><div class=modal-header><h2>Ajouter un nouveau cours</h2><button class=close-btn onclick=closeAddCourseModal()><i class="fas fa-times"></i></button></div><div class=modal-body><div class=input-group><label for=course-name>Nom du cours</label><input id=course-name placeholder="Ex: Programmation Java"></div><div class=input-group><label for=course-file>Fichier du cours</label><input type=file id=course-file accept=.pdf,.txt,.docx,.doc><p class=input-note>Formats acceptés: PDF, TXT, DOCX, DOC</div></div><div class=modal-footer><button class="btn secondary"onclick=closeAddCourseModal()>Annuler</button><button class="btn primary"onclick=addCourse()>Ajouter le cours</button></div></div></div><div id=notification-toast class=notification-toast><div class=toast-content><i class=toast-icon></i><span class=toast-message></span></div><button class=toast-close onclick=hideNotification()><i class="fas fa-times"></i></button></div><div id=loading-spinner class=loading-spinner><div class=spinner></div><p>Traitement en cours...</div><script type=module>import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import{getFirestore,collection,addDoc,getDocs,doc,onSnapshot,query,where,orderBy,setDoc,getDoc,updateDoc,increment,limit,deleteDoc}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";import{getStorage,ref,uploadBytes,getDownloadURL,deleteObject}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";const firebaseConfig={apiKey:"AIzaSyCwYVursGqdwA47BgpjxFx-UuPOooorqcU",authDomain:"mboa-librerie.firebaseapp.com",projectId:"mboa-librerie",storageBucket:"mboa-librerie.appspot.com",messagingSenderId:"323486943031",appId:"1:323486943031:web:a536c81bfc61517eddfcb2",measurementId:"G-X514RE9V3G"},app=initializeApp(firebaseConfig),db=getFirestore(app),auth=getAuth(app),storage=getStorage(app),analytics=getAnalytics(app);window.firebaseDB=db,window.firebaseAuth=auth,window.firebaseStorage=storage,window.firebaseFunctions={collection:collection,addDoc:addDoc,getDocs:getDocs,doc:doc,onSnapshot:onSnapshot,query:query,where:where,orderBy:orderBy,setDoc:setDoc,getDoc:getDoc,updateDoc:updateDoc,increment:increment,limit:limit,deleteDoc:deleteDoc,createUserWithEmailAndPassword:createUserWithEmailAndPassword,signInWithEmailAndPassword:signInWithEmailAndPassword,signOut:signOut,onAuthStateChanged:onAuthStateChanged,ref:ref,uploadBytes:uploadBytes,getDownloadURL:getDownloadURL,deleteObject:deleteObject},window.FirebaseUtils={async saveUserData(e,n){try{const t=doc(db,"users",e);return await setDoc(t,n,{merge:!0}),!0}catch(e){return console.error("Erreur lors de la sauvegarde des données utilisateur:",e),!1}},async getUserData(e){try{const n=doc(db,"users",e),t=await getDoc(n);return t.exists()?t.data():null}catch(e){return console.error("Erreur lors de la récupération des données utilisateur:",e),null}},async saveCourse(e,n){try{const t=collection(db,"courses"),s={...n,userId:e,createdAt:new Date,updatedAt:new Date};return(await addDoc(t,s)).id}catch(e){return console.error("Erreur lors de la sauvegarde du cours:",e),null}},async getUserCourses(e){try{const n=collection(db,"courses"),t=query(n,where("userId","==",e),orderBy("createdAt","desc")),s=await getDocs(t),a=[];return s.forEach((e=>{a.push({id:e.id,...e.data()})})),a}catch(e){return console.error("Erreur lors de la récupération des cours:",e),[]}},async saveStudySession(e,n){try{const t=collection(db,"studySessions"),s={...n,userId:e,createdAt:new Date};return await addDoc(t,s),!0}catch(e){return console.error("Erreur lors de la sauvegarde de la session:",e),!1}},async getStudySessions(e,n=50){try{const t=collection(db,"studySessions"),s=query(t,where("userId","==",e),orderBy("createdAt","desc"),n(n)),a=await getDocs(s),i=[];return a.forEach((e=>{i.push({id:e.id,...e.data()})})),i}catch(e){return console.error("Erreur lors de la récupération des sessions:",e),[]}},async updateSuccessPercentage(e,n){try{const t=doc(db,"users",e);return await updateDoc(t,{successPercentage:n,lastUpdated:new Date}),!0}catch(e){return console.error("Erreur lors de la mise à jour du pourcentage:",e),!1}},async saveSchedule(e,n){try{const t=doc(db,"schedules",e);return await setDoc(t,{...n,userId:e,createdAt:new Date,updatedAt:new Date}),!0}catch(e){return console.error("Erreur lors de la sauvegarde du planning:",e),!1}},async getSchedule(e){try{const n=doc(db,"schedules",e),t=await getDoc(n);return t.exists()?t.data():null}catch(e){return console.error("Erreur lors de la récupération du planning:",e),null}},async sendFriendRequest(e,n){try{const t=collection(db,"friendRequests");return await addDoc(t,{from:e,to:n,status:"pending",createdAt:new Date}),!0}catch(e){return console.error("Erreur lors de l'envoi de l'invitation:",e),!1}},async getFriendRequests(e){try{const n=collection(db,"friendRequests"),t=query(n,where("to","==",e),where("status","==","pending")),s=await getDocs(t),a=[];return s.forEach((e=>{a.push({id:e.id,...e.data()})})),a}catch(e){return console.error("Erreur lors de la récupération des invitations:",e),[]}},async searchUsers(e,n){try{const t=collection(db,"users"),s=await getDocs(t),a=[];return s.forEach((t=>{const s=t.data();t.id!==n&&s.name.toLowerCase().includes(e.toLowerCase())&&a.push({id:t.id,...s})})),a}catch(e){return console.error("Erreur lors de la recherche d'utilisateurs:",e),[]}}},console.log("Firebase initialisé avec succès");class AIService{constructor(){this.apiKey="AIzaSyCvaO6SaziVLZP7w0pwe9p_quLl4yoUWUY",this.baseUrl="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent"}async makeAPICall(e,n=1e3){try{const t=await fetch(`${this.baseUrl}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:e}]}],generationConfig:{maxOutputTokens:n,temperature:.7}})});if(!t.ok)throw new Error(`Erreur API: ${t.status}`);const s=await t.json();if(s.candidates&&s.candidates[0]&&s.candidates[0].content)return s.candidates[0].content.parts[0].text;throw new Error("Réponse API invalide")}catch(e){throw console.error("Erreur lors de l'appel API:",e),e}}async analyzeCourse(e,n){const t=`\nTu es un assistant éducatif intelligent pour des étudiants en génie logiciel L2. \nAnalyse le cours suivant et identifie tous les chapitres/leçons disponibles.\n\nNom du cours: ${n}\nContenu du cours: ${e}\n\nRéponds UNIQUEMENT avec un objet JSON contenant:\n{\n  "chapters": [\n    {\n      "id": 1,\n      "title": "Titre du chapitre 1",\n      "description": "Brève description"\n    },\n    {\n      "id": 2, \n      "title": "Titre du chapitre 2",\n      "description": "Brève description"\n    }\n  ],\n  "recommendation": "Quel chapitre recommandes-tu de commencer ?"\n}\n\nAssure-toi que le JSON soit valide et bien formaté.`;try{const e=await this.makeAPICall(t,2e3);return JSON.parse(e)}catch(e){return console.error("Erreur lors de l'analyse du cours:",e),{chapters:[{id:1,title:"Chapitre principal",description:"Contenu principal du cours"}],recommendation:"Commencez par le chapitre principal pour une vue d'ensemble."}}}async generateSummaryAndQuestions(e,n,t="L2"){const s=`\nTu es un assistant éducatif pour des étudiants en génie logiciel ${t}.\nPour le chapitre "${n}", génère:\n\n1. Un résumé clair et bien structuré (200-300 mots)\n2. 8-10 questions pertinentes avec 4 choix de réponse chacune\n\nContenu du cours: ${e}\n\nRéponds UNIQUEMENT avec un objet JSON:\n{\n  "summary": "Résumé détaillé et bien structuré du chapitre...",\n  "questions": [\n    {\n      "id": 1,\n      "question": "Question ici ?",\n      "options": ["Option A", "Option B", "Option C", "Option D"],\n      "correct": 0,\n      "explanation": "Explication de la bonne réponse"\n    }\n  ]\n}\n\nAssure-toi que:\n- Le résumé soit pédagogique et accessible\n- Les questions testent vraiment la compréhension\n- Les explications soient claires et éducatives\n- Le JSON soit parfaitement formaté`;try{const e=await this.makeAPICall(s,3e3);return JSON.parse(e)}catch(e){return console.error("Erreur lors de la génération:",e),{summary:"Résumé non disponible pour le moment. Veuillez réessayer.",questions:[{id:1,question:"Question exemple ?",options:["Option A","Option B","Option C","Option D"],correct:0,explanation:"Explication exemple"}]}}}async chatResponse(e,n,t=[]){const s={programmation:"programmation et développement logiciel",algorithmique:"algorithmique et structures de données","bases-donnees":"bases de données et SQL","genie-logiciel":"génie logiciel et méthodes de développement",reseaux:"réseaux informatiques et protocoles",securite:"sécurité informatique et cryptographie",ia:"intelligence artificielle et machine learning",web:"développement web et technologies internet"}[n]||"informatique générale",a=`\nTu es un assistant éducatif spécialisé en ${s} pour des étudiants en L2 génie logiciel.\nTu dois UNIQUEMENT répondre à des questions éducatives liées à ${s}.\n\nSi la question n'est pas éducative ou hors sujet, réponds poliment que tu ne peux aider que sur les sujets éducatifs.\n\nHistorique de la conversation:\n${t.map((e=>`${e.sender}: ${e.text}`)).join("\n")}\n\nQuestion de l'étudiant: ${e}\n\nRéponds de manière:\n- Pédagogique et claire\n- Adaptée au niveau L2\n- Avec des exemples pratiques si pertinent\n- En français\n- Maximum 300 mots\n\nRéponse:`;try{return(await this.makeAPICall(a,1500)).trim()}catch(e){return console.error("Erreur dans le chat:",e),"Désolé, je rencontre des difficultés techniques. Pouvez-vous reformuler votre question ?"}}async analyzeImage(e,n=""){const t=`\nTu es un assistant éducatif. Analyse cette image dans le contexte de l'apprentissage du génie logiciel.\nDécris ce que tu vois et explique comment cela peut aider l'étudiant.\n\nContexte supplémentaire: ${n}\n\nRéponds en français, de manière éducative et constructive (maximum 200 mots).`;try{const n=await fetch(`${this.baseUrl}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:t},{inline_data:{mime_type:"image/jpeg",data:e}}]}],generationConfig:{maxOutputTokens:1e3,temperature:.7}})});if(!n.ok)throw new Error(`Erreur API: ${n.status}`);const s=await n.json();if(s.candidates&&s.candidates[0]&&s.candidates[0].content)return s.candidates[0].content.parts[0].text;throw new Error("Réponse API invalide")}catch(e){return console.error("Erreur lors de l'analyse d'image:",e),"Désolé, je n'ai pas pu analyser cette image. Assurez-vous qu'elle soit claire et liée à vos études."}}async generateSuggestions(e,n,t){const s=`\nTu es un conseiller pédagogique IA. Génère 3-5 suggestions personnalisées pour cet étudiant en L2 génie logiciel.\n\nDonnées de l'étudiant:\n- Taux de réussite: ${e.successPercentage||0}%\n- Matières faibles: ${n.join(", ")||"Aucune"}\n- Sessions d'étude récentes: ${t.length}\n- Dernière activité: ${e.lastActivity||"Inconnue"}\n\nGénère des suggestions:\n- Pratiques et réalisables\n- Spécifiques aux matières faibles\n- Motivantes et encourageantes\n- En français\n- Maximum 50 mots par suggestion\n\nRéponds avec un tableau JSON:\n["Suggestion 1", "Suggestion 2", "Suggestion 3"]`;try{const e=await this.makeAPICall(s,1e3);return JSON.parse(e)}catch(e){return console.error("Erreur lors de la génération de suggestions:",e),["Révisez vos cours quotidiennement pendant 30 minutes","Pratiquez les exercices des matières les plus difficiles","Créez des fiches de révision pour mieux mémoriser"]}}async generateWeeklySchedule(e,n,t){const s=`\nGénère un planning d'étude hebdomadaire personnalisé (Lundi à Samedi, Dimanche = repos).\n\nPréférences de l'utilisateur:\n- Disponibilité: ${e.availability||"Après 18h"}\n- Heure de coucher: ${e.bedtime||"23h"}\n- Heure de réveil: ${e.wakeup||"7h"}\n- Matières faibles: ${t.join(", ")||"Aucune"}\n\nCours disponibles: ${n.map((e=>e.name)).join(", ")}\n\nCrée un planning avec:\n- 1-2h d'étude par jour maximum\n- Plus de temps sur les matières faibles\n- Révisions variées\n- Pauses appropriées\n\nRéponds UNIQUEMENT avec un objet JSON:\n{\n  "lundi": [\n    {"time": "18:00", "subject": "Programmation", "duration": 60, "type": "revision"}\n  ],\n  "mardi": [...],\n  etc.\n}`;try{const e=await this.makeAPICall(s,2e3);return JSON.parse(e)}catch(e){return console.error("Erreur lors de la génération du planning:",e),this.getDefaultSchedule()}}getDefaultSchedule(){return{lundi:[{time:"18:00",subject:"Programmation",duration:60,type:"revision"}],mardi:[{time:"18:00",subject:"Algorithmique",duration:60,type:"exercices"}],mercredi:[{time:"18:00",subject:"Bases de données",duration:60,type:"revision"}],jeudi:[{time:"18:00",subject:"Génie logiciel",duration:60,type:"étude"}],vendredi:[{time:"18:00",subject:"Révisions générales",duration:60,type:"revision"}],samedi:[{time:"14:00",subject:"Projets pratiques",duration:90,type:"pratique"}]}}async createMockExam(e,n,t="medium"){const s=`\nCrée un examen blanc de ${n} pour un étudiant L2 génie logiciel.\nNiveau de difficulté: ${t}\n\nCours étudiés: ${e.map((e=>e.name)).join(", ")}\n\nGénère un examen avec:\n- 15-20 questions variées\n- QCM, vrai/faux, questions courtes\n- Couvrant tous les aspects importants\n- Temps estimé: 90 minutes\n\nRéponds avec un objet JSON:\n{\n  "title": "Examen blanc - ${n}",\n  "duration": 90,\n  "totalPoints": 20,\n  "questions": [\n    {\n      "id": 1,\n      "type": "mcq",\n      "question": "Question...",\n      "options": ["A", "B", "C", "D"],\n      "correct": 0,\n      "points": 1\n    },\n    {\n      "id": 2,\n      "type": "boolean",\n      "question": "Vrai ou faux...",\n      "correct": true,\n      "points": 1\n    }\n  ]\n}`;try{const e=await this.makeAPICall(s,3e3);return JSON.parse(e)}catch(e){return console.error("Erreur lors de la création de l'examen:",e),this.getDefaultMockExam(n)}}getDefaultMockExam(e){return{title:`Examen blanc - ${e}`,duration:90,totalPoints:20,questions:[{id:1,type:"mcq",question:"Quelle est la complexité temporelle de la recherche dans un tableau trié ?",options:["O(1)","O(log n)","O(n)","O(n²)"],correct:1,points:1},{id:2,type:"boolean",question:"Un algorithme récursif peut toujours être transformé en algorithme itératif.",correct:!0,points:1}]}}async evaluateAndAdvise(e,n,t){const s=this.calculateScore(e,n),a=this.identifyWeakAreas(e,n),i=`\nL'étudiant a obtenu ${s}/${n.totalPoints} à l'examen "${n.title}".\nDomaines faibles identifiés: ${a.join(", ")}\n\nProfil de l'étudiant:\n- Niveau: L2 génie logiciel\n- Taux de réussite habituel: ${t.successPercentage||0}%\n\nGénère des conseils personnalisés:\n- Félicitations/encouragements appropriés\n- Recommandations spécifiques pour s'améliorer\n- Plan de révision ciblé\n- Motivation positive\n\nRéponds en français, format texte (200-300 mots).`;try{const e=await this.makeAPICall(i,1500);return{score:s,totalPoints:n.totalPoints,percentage:Math.round(s/n.totalPoints*100),advice:e.trim(),weakAreas:a}}catch(e){return console.error("Erreur lors de l'évaluation:",e),{score:s,totalPoints:n.totalPoints,percentage:Math.round(s/n.totalPoints*100),advice:"Continuez vos efforts ! Concentrez-vous sur les domaines où vous avez eu des difficultés.",weakAreas:a}}}calculateScore(e,n){let t=0;return n.questions.forEach(((n,s)=>{void 0!==e[s]&&("mcq"===n.type&&e[s]===n.correct||"boolean"===n.type&&e[s]===n.correct)&&(t+=n.points)})),t}identifyWeakAreas(e,n){const t=[];return n.questions.forEach(((n,s)=>{if(void 0===e[s]||"mcq"===n.type&&e[s]!==n.correct||"boolean"===n.type&&e[s]!==n.correct){const e=n.question.toLowerCase();e.includes("algorithme")||e.includes("complexité")?t.includes("Algorithmique")||t.push("Algorithmique"):e.includes("programme")||e.includes("code")?t.includes("Programmation")||t.push("Programmation"):(e.includes("base")||e.includes("données"))&&(t.includes("Bases de données")||t.push("Bases de données"))}})),t.length>0?t:["Révision générale"]}}window.aiService=new AIService,console.log("Service IA initialisé");class AuthManager{constructor(){this.currentUser=null,this.initAuth()}initAuth(){window.firebaseFunctions.onAuthStateChanged(window.firebaseAuth,(e=>{e?(this.currentUser=e,this.handleAuthenticatedUser(e)):(this.currentUser=null,this.showAuthScreen())}))}showAuthScreen(){document.getElementById("auth-screen").style.display="flex",document.getElementById("app").style.display="none"}showApp(){document.getElementById("auth-screen").style.display="none",document.getElementById("app").style.display="flex"}async handleAuthenticatedUser(e){try{let n=await window.FirebaseUtils.getUserData(e.uid);n||(n={name:e.displayName||e.email.split("@")[0],email:e.email,level:"L2",successPercentage:0,createdAt:new Date,lastActivity:new Date,studyStreak:0,totalSessions:0,averageScore:0,preferences:{notifications:!0,aiSuggestions:!0,studyReminders:!0}},await window.FirebaseUtils.saveUserData(e.uid,n)),this.updateUserInterface(n),this.saveToLocalStorage("userData",n),this.showApp(),window.dashboardManager&&window.dashboardManager.loadDashboard(),this.checkDailyReminders()}catch(e){console.error("Erreur lors du chargement du profil utilisateur:",e),showNotification("Erreur lors du chargement du profil","error")}}updateUserInterface(e){const n=document.querySelectorAll("#user-name"),t=document.querySelectorAll("#user-level");n.forEach((n=>{n.textContent=e.name||"Utilisateur"})),t.forEach((n=>{n.textContent=`${e.level||"L2"} - Génie Logiciel`}))}async register(e,n,t,s){try{showLoading(!0);const a=(await window.firebaseFunctions.createUserWithEmailAndPassword(window.firebaseAuth,e,n)).user,i={name:t,email:e,level:s,successPercentage:0,createdAt:new Date,lastActivity:new Date,studyStreak:0,totalSessions:0,averageScore:0,preferences:{notifications:!0,aiSuggestions:!0,studyReminders:!0}};await window.FirebaseUtils.saveUserData(a.uid,i),showNotification("Compte créé avec succès ! Bienvenue sur StudyAI !","success")}catch(e){console.error("Erreur lors de l'inscription:",e);let n="Erreur lors de l'inscription";switch(e.code){case"auth/email-already-in-use":n="Cette adresse email est déjà utilisée";break;case"auth/weak-password":n="Le mot de passe doit contenir au moins 6 caractères";break;case"auth/invalid-email":n="Adresse email invalide"}showNotification(n,"error")}finally{showLoading(!1)}}async login(e,n){try{showLoading(!0),await window.firebaseFunctions.signInWithEmailAndPassword(window.firebaseAuth,e,n),showNotification("Connexion réussie ! Bon retour !","success")}catch(e){console.error("Erreur lors de la connexion:",e);let n="Erreur lors de la connexion";switch(e.code){case"auth/user-not-found":n="Aucun compte trouvé avec cette adresse email";break;case"auth/wrong-password":n="Mot de passe incorrect";break;case"auth/invalid-email":n="Adresse email invalide"}showNotification(n,"error")}finally{showLoading(!1)}}async logout(){try{await window.firebaseFunctions.signOut(window.firebaseAuth),localStorage.clear(),showNotification("Déconnexion réussie","info")}catch(e){console.error("Erreur lors de la déconnexion:",e),showNotification("Erreur lors de la déconnexion","error")}}getCurrentUser(){return this.currentUser}getCurrentUserId(){return this.currentUser?this.currentUser.uid:null}saveToLocalStorage(e,n){try{localStorage.setItem(e,JSON.stringify(n))}catch(e){console.error("Erreur lors de la sauvegarde localStorage:",e)}}getFromLocalStorage(e){try{const n=localStorage.getItem(e);return n?JSON.parse(n):null}catch(e){return console.error("Erreur lors de la récupération localStorage:",e),null}}async updateUserProfile(e){if(!this.currentUser)return!1;try{await window.FirebaseUtils.saveUserData(this.currentUser.uid,{...e,lastUpdated:new Date});const n=this.getFromLocalStorage("userData")||{};return this.saveToLocalStorage("userData",{...n,...e}),!0}catch(e){return console.error("Erreur lors de la mise à jour du profil:",e),!1}}checkDailyReminders(){const e=this.getFromLocalStorage("userData");if(!e||!e.preferences.studyReminders)return;const n=e.lastActivity?new Date(e.lastActivity):null,t=new Date;(!n||t-n>864e5)&&this.sendStudyReminder()}sendStudyReminder(){"Notification"in window&&Notification.requestPermission().then((e=>{"granted"===e&&new Notification("StudyAI - Rappel d'étude",{body:"Il est temps de reprendre vos révisions ! Votre réussite compte sur votre régularité.",icon:"/favicon.ico"})})),showNotification("N'oubliez pas de réviser aujourd'hui ! La régularité est la clé du succès.","info")}}window.handleLogin=async function(){const e=document.getElementById("login-email").value,n=document.getElementById("login-password").value;e&&n?await window.authManager.login(e,n):showNotification("Veuillez remplir tous les champs","warning")},window.handleRegister=async function(){const e=document.getElementById("register-name").value,n=document.getElementById("register-email").value,t=document.getElementById("register-password").value,s=document.getElementById("register-level").value;e&&n&&t&&s?t.length<6?showNotification("Le mot de passe doit contenir au moins 6 caractères","warning"):await window.authManager.register(n,t,e,s):showNotification("Veuillez remplir tous les champs","warning")},window.handleLogout=async function(){confirm("Êtes-vous sûr de vouloir vous déconnecter ?")&&await window.authManager.logout()},document.addEventListener("DOMContentLoaded",(()=>{window.authManager=new AuthManager;const e=document.querySelectorAll(".auth-tab"),n=document.querySelectorAll(".auth-form");e.forEach((t=>{t.addEventListener("click",(()=>{const s=t.dataset.tab;e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),n.forEach((e=>{e.classList.remove("active"),e.id===`${s}-form`&&e.classList.add("active")}))}))})),document.getElementById("login-password").addEventListener("keypress",(e=>{"Enter"===e.key&&handleLogin()})),document.getElementById("register-password").addEventListener("keypress",(e=>{"Enter"===e.key&&handleRegister()}))})),console.log("Gestionnaire d'authentification initialisé");class NotificationManager{constructor(){this.notificationQueue=[],this.isShowing=!1,this.requestPermission()}requestPermission(){"Notification"in window&&Notification.requestPermission()}show(e,n="info",t=5e3){const s={message:e,type:n,duration:t,timestamp:Date.now()};this.notificationQueue.push(s),this.isShowing||this.showNext()}showNext(){if(0===this.notificationQueue.length)return void(this.isShowing=!1);this.isShowing=!0;const e=this.notificationQueue.shift(),n=document.getElementById("notification-toast"),t=n.querySelector(".toast-icon"),s=n.querySelector(".toast-message"),a={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};t.className=`toast-icon ${a[e.type]||a.info}`,s.textContent=e.message,n.className=`notification-toast ${e.type}`,setTimeout((()=>{n.classList.add("show")}),100),setTimeout((()=>{this.hide()}),e.duration)}hide(){document.getElementById("notification-toast").classList.remove("show"),setTimeout((()=>{this.showNext()}),300)}hideImmediately(){document.getElementById("notification-toast").classList.remove("show"),this.isShowing=!1,this.notificationQueue=[]}showBrowserNotification(e,n,t="/favicon.ico"){if("Notification"in window&&"granted"===Notification.permission){const s=new Notification(e,{body:n,icon:t,requireInteraction:!1});return setTimeout((()=>s.close()),5e3),s}return null}scheduleStudyReminder(e=10){setTimeout((()=>{this.showBrowserNotification("StudyAI - Rappel d'étude","Votre session d'étude commence dans 10 minutes. Préparez-vous !","/favicon.ico"),this.show("Session d'étude dans 10 minutes !","info")}),60*(e-10)*1e3)}notifySessionEnd(){this.showBrowserNotification("StudyAI - Session terminée","Félicitations ! N'oubliez pas de marquer votre session comme terminée.","/favicon.ico"),this.show("Session d'étude terminée ! Validez votre progression.","success")}notifyInactivity(){this.show("Vous n'avez pas étudié aujourd'hui. Reprenez vos révisions !","warning"),this.showBrowserNotification("StudyAI - Rappel d'activité","La régularité est importante pour votre réussite. Reprenez vos études !","/favicon.ico")}celebrateSuccess(e){this.show(e,"success"),this.showConfetti()}showConfetti(){for(let e=0;e<20;e++){const e=document.createElement("div");e.style.cssText=`\n        position: fixed;\n        top: -10px;\n        left: ${100*Math.random()}vw;\n        width: 10px;\n        height: 10px;\n        background: ${["#3B82F6","#10B981","#F59E0B","#EF4444"][Math.floor(4*Math.random())]};\n        z-index: 10000;\n        pointer-events: none;\n        animation: confetti-fall 3s linear forwards;\n      `,document.body.appendChild(e),setTimeout((()=>e.remove()),3e3)}}notifyFriendRequest(e){this.show(`${e} vous a envoyé une invitation d'amitié`,"info")}warnNonEducationalContent(){this.show("⚠️ Attention : Gardez vos discussions éducatives et liées aux études","warning")}notifyLowScore(e,n){this.show(`Score de ${e}/10 en ${n}. Concentrez-vous sur cette matière !`,"warning")}notifyProgress(e){e>=80?this.celebrateSuccess(`Excellent ! Vous avez atteint ${e}% de réussite !`):e>=60?this.show(`Bon travail ! Taux de réussite: ${e}%`,"success"):this.show(`Continuez vos efforts. Taux actuel: ${e}%`,"info")}}window.notificationManager=new NotificationManager,window.showNotification=function(e,n="info",t=5e3){window.notificationManager.show(e,n,t)},window.hideNotification=function(){window.notificationManager.hideImmediately()},window.showLoading=function(e=!0){const n=document.getElementById("loading-spinner");e?n.classList.add("active"):n.classList.remove("active")};const confettiStyles=document.createElement("style");confettiStyles.textContent="\n  @keyframes confetti-fall {\n    0% {\n      transform: translateY(-10px) rotate(0deg);\n      opacity: 1;\n    }\n    100% {\n      transform: translateY(100vh) rotate(360deg);\n      opacity: 0;\n    }\n  }\n",document.head.appendChild(confettiStyles),console.log("Gestionnaire de notifications initialisé");class DashboardManager{constructor(){this.userData=null,this.courses=[],this.studySessions=[],this.weakSubjects=[],this.init()}async init(){await this.loadData(),this.updateDisplay(),this.generateAISuggestions(),this.schedulePeriodicUpdates()}async loadData(){if(window.authManager.getCurrentUserId())try{const e=window.authManager.getCurrentUserId();this.userData=await window.FirebaseUtils.getUserData(e)||window.authManager.getFromLocalStorage("userData")||this.getDefaultUserData(),this.courses=await window.FirebaseUtils.getUserCourses(e),this.studySessions=await window.FirebaseUtils.getStudySessions(e,30),this.analyzeWeakSubjects()}catch(e){console.error("Erreur lors du chargement des données:",e),this.loadFromLocalStorage()}}loadFromLocalStorage(){this.userData=window.authManager.getFromLocalStorage("userData")||this.getDefaultUserData(),this.courses=window.authManager.getFromLocalStorage("courses")||[],this.studySessions=window.authManager.getFromLocalStorage("studySessions")||[]}getDefaultUserData(){return{successPercentage:0,studyStreak:0,totalSessions:0,averageScore:0,lastActivity:new Date,preferences:{notifications:!0,aiSuggestions:!0}}}updateDisplay(){this.updateStatistics(),this.updateSuccessPercentage(),this.updateWeeklyProgress(),this.displayWeakSubjects(),this.checkForWarnings()}updateStatistics(){document.getElementById("total-courses").textContent=this.courses.length;const e=this.studySessions.filter((e=>e.completed)).length;document.getElementById("sessions-completed").textContent=e;const n=this.studySessions.filter((e=>void 0!==e.score)).map((e=>e.score)),t=n.length>0?Math.round(n.reduce(((e,n)=>e+n),0)/n.length):0;document.getElementById("average-score").textContent=`${t}/10`,document.getElementById("study-streak").textContent=this.calculateStudyStreak()}calculateStudyStreak(){if(0===this.studySessions.length)return 0;const e=new Date;let n=0,t=new Date(e);for(let e=0;e<30;e++){const e=t.toDateString();if(!this.studySessions.some((n=>new Date(n.createdAt).toDateString()===e&&n.completed)))break;n++,t.setDate(t.getDate()-1)}return n}updateSuccessPercentage(){const e=this.userData.successPercentage||0;document.getElementById("success-percentage").textContent=`${e}%`;const n=document.querySelector(".percentage-circle"),t=e/100*360;n.style.background=`conic-gradient(var(--primary) ${t}deg, var(--gray-200) ${t}deg)`,n.style.transition="background 1s ease-out"}updateWeeklyProgress(){const e=this.calculateWeeklyProgress();document.getElementById("weekly-progress").style.width=`${e}%`,document.getElementById("progress-text").textContent=`${e}% de la semaine complétée`}calculateWeeklyProgress(){const e=new Date;e.setDate(e.getDate()-e.getDay()+1),e.setHours(0,0,0,0);const n=new Date,t=this.studySessions.filter((t=>{const s=new Date(t.createdAt);return s>=e&&s<=n})).filter((e=>e.completed)).length;return Math.min(100,Math.round(t/5*100))}analyzeWeakSubjects(){const e={};this.studySessions.forEach((n=>{n.subject&&void 0!==n.score&&(e[n.subject]||(e[n.subject]=[]),e[n.subject].push(n.score))})),this.weakSubjects=[],Object.keys(e).forEach((n=>{const t=e[n],s=t.reduce(((e,n)=>e+n),0)/t.length;s<6&&this.weakSubjects.push({subject:n,average:Math.round(10*s)/10})})),this.weakSubjects.sort(((e,n)=>e.average-n.average))}displayWeakSubjects(){const e=document.getElementById("weak-subjects");if(0===this.weakSubjects.length)return void(e.innerHTML='<p class="no-data">Aucune matière faible identifiée. Continuez comme ça !</p>');const n=this.weakSubjects.map((e=>`\n      <div class="weak-subject-item">\n        <span class="subject-name">${e.subject}</span>\n        <span class="subject-score">${e.average}/10</span>\n      </div>\n    `)).join("");e.innerHTML=n}async generateAISuggestions(){try{const e=await window.aiService.generateSuggestions(this.userData,this.weakSubjects.map((e=>e.subject)),this.studySessions);this.displayAISuggestions(e)}catch(e){console.error("Erreur lors de la génération de suggestions:",e),this.displayDefaultSuggestions()}}displayAISuggestions(e){const n=document.getElementById("ai-suggestions");if(!e||0===e.length)return void this.displayDefaultSuggestions();const t=e.map((e=>`\n      <div class="ai-suggestion-item">\n        <p class="suggestion-text">${e}</p>\n      </div>\n    `)).join("");n.innerHTML=t}displayDefaultSuggestions(){const e=document.getElementById("ai-suggestions"),n=["Commencez par ajouter vos premiers cours pour recevoir des suggestions personnalisées","Établissez une routine d'étude régulière de 30 minutes par jour","Concentrez-vous sur une matière à la fois pour une meilleure compréhension"].map((e=>`\n      <div class="ai-suggestion-item">\n        <p class="suggestion-text">${e}</p>\n      </div>\n    `)).join("");e.innerHTML=n}checkForWarnings(){const e=new Date,n=this.userData.lastActivity?new Date(this.userData.lastActivity):null;n&&e-n>864e5&&this.showInactivityWarning(),this.userData.successPercentage>0&&this.userData.successPercentage<40&&this.showPerformanceWarning(),this.userData.successPercentage>=80&&this.showEncouragement()}showInactivityWarning(){this.insertNotification('\n      <div class="dashboard-notification warning">\n        <i class="fas fa-exclamation-triangle"></i>\n        <div>\n          <strong>Attention !</strong><br>\n          Vous n\'avez pas étudié depuis plus de 24h. La régularité est importante pour votre réussite !\n        </div>\n      </div>\n    '),window.notificationManager.notifyInactivity()}showPerformanceWarning(){const e=`\n      <div class="dashboard-notification warning">\n        <i class="fas fa-chart-line"></i>\n        <div>\n          <strong>Amélioration nécessaire</strong><br>\n          Votre taux de réussite est actuellement de ${this.userData.successPercentage}%. \n          Concentrez-vous sur vos matières faibles !\n        </div>\n      </div>\n    `;this.insertNotification(e)}showEncouragement(){const e=`\n      <div class="dashboard-notification success">\n        <i class="fas fa-trophy"></i>\n        <div>\n          <strong>Excellent travail !</strong><br>\n          Votre taux de réussite de ${this.userData.successPercentage}% est remarquable ! Continuez ainsi !\n        </div>\n      </div>\n    `;this.insertNotification(e)}insertNotification(e){const n=document.querySelector(".dashboard-grid");if(n){const t=document.createElement("div");t.innerHTML=e,n.insertBefore(t.firstElementChild,n.firstChild)}}async updateUserData(e){try{this.userData={...this.userData,...e},window.authManager.getCurrentUserId()&&await window.FirebaseUtils.saveUserData(window.authManager.getCurrentUserId(),this.userData),window.authManager.saveToLocalStorage("userData",this.userData),this.updateDisplay()}catch(e){console.error("Erreur lors de la mise à jour:",e)}}async addStudySession(e){try{this.studySessions.unshift(e),window.authManager.getCurrentUserId()&&await window.FirebaseUtils.saveStudySession(window.authManager.getCurrentUserId(),e),window.authManager.saveToLocalStorage("studySessions",this.studySessions),this.recalculateUserStats(),this.updateDisplay()}catch(e){console.error("Erreur lors de l'ajout de la session:",e)}}recalculateUserStats(){const e=this.studySessions.filter((e=>e.completed)),n=this.studySessions.filter((e=>void 0!==e.score)).map((e=>e.score)),t={totalSessions:e.length,averageScore:n.length>0?Math.round(n.reduce(((e,n)=>e+n),0)/n.length):0,studyStreak:this.calculateStudyStreak(),lastActivity:new Date};t.successPercentage=this.calculateSuccessPercentage(t),this.updateUserData(t)}calculateSuccessPercentage(e){const n=Math.min(100,10*e.averageScore),t=Math.min(20,2*e.studyStreak),s=Math.min(10,e.totalSessions);return Math.min(100,Math.round(n+t+s))}schedulePeriodicUpdates(){setInterval((()=>{this.updateWeeklyProgress()}),3e5),setInterval((()=>{this.checkForWarnings()}),36e5),setInterval((()=>{this.loadData()}),18e5)}async loadDashboard(){showLoading(!0);try{await this.loadData(),this.updateDisplay(),await this.generateAISuggestions()}catch(e){console.error("Erreur lors du rechargement:",e),showNotification("Erreur lors du rechargement des données","error")}finally{showLoading(!1)}}}document.addEventListener("DOMContentLoaded",(()=>{window.dashboardManager=new DashboardManager})),window.clearAllData=async function(){if(!confirm("Êtes-vous vraiment sûr de vouloir effacer toutes vos données ? Cette action est irréversible et supprimera tous vos cours, sessions d'étude et statistiques."))return;if(confirm("DERNIÈRE CONFIRMATION : Toutes vos données seront perdues définitivement. Continuer ?"))try{showLoading(!0),localStorage.clear(),window.authManager.getCurrentUserId()&&await window.FirebaseUtils.saveUserData(window.authManager.getCurrentUserId(),window.dashboardManager.getDefaultUserData()),showNotification("Toutes les données ont été effacées","info"),setTimeout((()=>{window.location.reload()}),2e3)}catch(e){console.error("Erreur lors de l'effacement:",e),showNotification("Erreur lors de l'effacement des données","error")}finally{showLoading(!1)}},console.log("Gestionnaire de dashboard initialisé");class CoursesManager{constructor(){this.courses=[],this.currentCourse=null,this.currentChapter=null,this.currentQuestions=[],this.userAnswers=[],this.init()}async init(){await this.loadCourses(),this.setupEventListeners()}async loadCourses(){try{window.authManager.getCurrentUserId()?this.courses=await window.FirebaseUtils.getUserCourses(window.authManager.getCurrentUserId()):this.courses=window.authManager.getFromLocalStorage("courses")||[],this.displayCourses()}catch(e){console.error("Erreur lors du chargement des cours:",e),this.courses=[],this.displayCourses()}}displayCourses(){const e=document.getElementById("courses-grid");if(0===this.courses.length)return void(e.innerHTML='\n        <div class="no-data">\n          <i class="fas fa-book" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>\n          <p>Aucun cours ajouté. Commencez par ajouter votre premier cours !</p>\n          <button class="btn primary" onclick="openAddCourseModal()">\n            <i class="fas fa-plus"></i>\n            Ajouter un cours\n          </button>\n        </div>\n      ');const n=this.courses.map((e=>`\n      <div class="course-card" data-course-id="${e.id}">\n        <div class="course-header">\n          <div class="course-status ${e.status||"new"}">\n            ${this.getStatusText(e.status)}\n          </div>\n          <h3 class="course-title">${e.name}</h3>\n          <div class="course-meta">\n            <span><i class="fas fa-calendar"></i> ${this.formatDate(e.createdAt)}</span>\n            <span><i class="fas fa-file"></i> ${e.fileType||"Document"}</span>\n          </div>\n        </div>\n        <div class="course-body">\n          <div class="course-stats">\n            <span>Sessions: ${e.sessionsCount||0}</span>\n            <span>Score moyen: ${e.averageScore||0}/10</span>\n          </div>\n          <div class="course-actions">\n            <button class="btn primary" onclick="studyCourse('${e.id}')">\n              <i class="fas fa-play"></i>\n              Étudier\n            </button>\n            <button class="btn secondary" onclick="deleteCourse('${e.id}')">\n              <i class="fas fa-trash"></i>\n              Supprimer\n            </button>\n          </div>\n        </div>\n      </div>\n    `)).join("");e.innerHTML=n}getStatusText(e){return{new:"Nouveau","in-progress":"En cours",completed:"Terminé"}[e]||"Nouveau"}formatDate(e){return new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}openAddCourseModal(){const e=document.getElementById("add-course-modal");e.classList.add("active"),e.style.display="flex",document.getElementById("course-name").value="",document.getElementById("course-file").value=""}closeAddCourseModal(){const e=document.getElementById("add-course-modal");e.classList.remove("active"),setTimeout((()=>{e.style.display="none"}),300)}async addCourse(){const e=document.getElementById("course-name").value.trim(),n=document.getElementById("course-file");if(e)if(n.files[0])try{showLoading(!0);const t=n.files[0],s=await this.readFileContent(t);if(!s||s.length<100)return void showNotification("Le fichier semble vide ou trop court","error");const a=await window.aiService.analyzeCourse(s,e),i={name:e,content:s,fileType:t.type,fileName:t.name,chapters:a.chapters||[],recommendation:a.recommendation||"",status:"new",sessionsCount:0,averageScore:0,createdAt:new Date,updatedAt:new Date};let r;if(window.authManager.getCurrentUserId()?r=await window.FirebaseUtils.saveCourse(window.authManager.getCurrentUserId(),i):(r=Date.now().toString(),i.id=r,this.courses.unshift(i),window.authManager.saveToLocalStorage("courses",this.courses)),!r)throw new Error("Erreur lors de la sauvegarde");i.id=r,this.courses.unshift(i),this.displayCourses(),this.closeAddCourseModal(),showNotification("Cours ajouté avec succès !","success"),window.dashboardManager&&window.dashboardManager.loadDashboard()}catch(e){console.error("Erreur lors de l'ajout du cours:",e),showNotification("Erreur lors de l'ajout du cours","error")}finally{showLoading(!1)}else showNotification("Veuillez sélectionner un fichier","warning");else showNotification("Veuillez saisir un nom pour le cours","warning")}readFileContent(e){return new Promise(((n,t)=>{const s=new FileReader;s.onload=function(e){n(e.target.result)},s.onerror=function(){t(new Error("Erreur lors de la lecture du fichier"))},e.type.includes("text")||e.name.endsWith(".txt"),s.readAsText(e)}))}async studyCourse(e){try{showLoading(!0);const n=this.courses.find((n=>n.id===e));if(!n)return void showNotification("Cours non trouvé","error");this.currentCourse=n,n.chapters&&n.chapters.length>1?this.showChapterSelection():await this.startStudySession(n.chapters[0]||{title:n.name})}catch(e){console.error("Erreur lors du démarrage de l'étude:",e),showNotification("Erreur lors du démarrage de l'étude","error")}finally{showLoading(!1)}}showChapterSelection(){const e=document.createElement("div");e.className="modal active",e.style.display="flex",e.id="chapter-selection-modal";const n=this.currentCourse.chapters.map((e=>`\n      <div class="chapter-option" onclick="selectChapter(${e.id})">\n        <h4>${e.title}</h4>\n        <p>${e.description}</p>\n      </div>\n    `)).join("");e.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h2>Choisir un chapitre à étudier</h2>\n          <button class="close-btn" onclick="closeChapterSelection()">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <p><strong>Recommandation IA:</strong> ${this.currentCourse.recommendation}</p>\n          <div class="chapters-list">\n            ${n}\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(e)}async selectChapter(e){const n=this.currentCourse.chapters.find((n=>n.id===e));n&&(this.closeChapterSelection(),await this.startStudySession(n))}closeChapterSelection(){const e=document.getElementById("chapter-selection-modal");e&&e.remove()}async startStudySession(e){try{showLoading(!0),this.currentChapter=e;const n=await window.aiService.generateSummaryAndQuestions(this.currentCourse.content,e.title);this.currentQuestions=n.questions||[],this.userAnswers=new Array(this.currentQuestions.length),this.showStudyInterface(n.summary,this.currentQuestions)}catch(e){console.error("Erreur lors de la génération du contenu:",e),showNotification("Erreur lors de la génération du contenu","error")}finally{showLoading(!1)}}showStudyInterface(e,n){const t=document.createElement("div");t.className="modal active study-modal",t.style.display="flex",t.id="study-modal";const s=n.map(((e,n)=>`\n      <div class="question-item" data-question-index="${n}">\n        <div class="question-text">${e.question}</div>\n        <div class="question-options">\n          ${e.options.map(((e,t)=>`\n            <label class="option-item">\n              <input type="radio" name="question_${n}" value="${t}" \n                     onchange="selectAnswer(${n}, ${t})">\n              <span>${e}</span>\n            </label>\n          `)).join("")}\n        </div>\n      </div>\n    `)).join("");t.innerHTML=`\n      <div class="modal-content">\n        <div class="modal-header">\n          <h2>Étude: ${this.currentChapter.title}</h2>\n          <button class="close-btn" onclick="closeStudySession()">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body">\n          <div class="study-content">\n            <div class="course-original">\n              <div class="content-section">\n                <h3><i class="fas fa-book-open"></i> Contenu original</h3>\n                <div class="content-text">\n                  ${this.getChapterContent()}\n                </div>\n              </div>\n            </div>\n            <div class="course-summary">\n              <div class="content-section">\n                <h3><i class="fas fa-brain"></i> Résumé IA</h3>\n                <div class="content-text">\n                  ${e}\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="questions-container">\n            <h3><i class="fas fa-question-circle"></i> Questions de compréhension</h3>\n            <div class="progress-indicator">\n              <span>Question <span id="current-question">1</span> sur ${n.length}</span>\n              <div class="progress-dots">\n                ${n.map(((e,n)=>`<div class="progress-dot" data-question="${n}"></div>`)).join("")}\n              </div>\n            </div>\n            ${s}\n            <div class="question-actions">\n              <button class="btn primary" onclick="checkAnswers()">\n                <i class="fas fa-check"></i>\n                Vérifier mes réponses\n              </button>\n            </div>\n            <div id="score-display" style="display: none;"></div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(t),this.updateProgressIndicators()}getChapterContent(){const e=this.currentCourse.content;return e.length<=1e3?e:e.substring(0,1e3)+"..."}selectAnswer(e,n){this.userAnswers[e]=n,this.updateProgressIndicators()}updateProgressIndicators(){const e=this.userAnswers.filter((e=>void 0!==e)).length;document.querySelectorAll(".progress-dot").forEach(((n,t)=>{n.classList.remove("active","completed"),void 0!==this.userAnswers[t]?n.classList.add("completed"):t===e&&n.classList.add("active")}));const n=document.getElementById("current-question");n&&(n.textContent=Math.min(e+1,this.currentQuestions.length))}checkAnswers(){if(this.userAnswers.includes(void 0))return void showNotification("Veuillez répondre à toutes les questions","warning");let e=0;const n=[];this.currentQuestions.forEach(((t,s)=>{const a=this.userAnswers[s],i=a===t.correct;i&&e++,n.push({question:t.question,userAnswer:t.options[a],correctAnswer:t.options[t.correct],correct:i,explanation:t.explanation||""});const r=document.querySelector(`[data-question-index="${s}"]`);if(r){const e=r.querySelectorAll(".option-item");e[a].classList.add(i?"correct":"incorrect"),i||e[t.correct].classList.add("correct")}}));const t=Math.round(e/this.currentQuestions.length*10);this.displayScore(e,this.currentQuestions.length,t),this.saveStudySession(e,t,n)}displayScore(e,n,t){const s=document.getElementById("score-display");let a="";a=t>=8?"🎉 Excellent ! Vous maîtrisez parfaitement ce chapitre !":t>=6?"👍 Bon travail ! Quelques points à revoir, mais c'est bien parti !":t>=4?"📚 Il faut encore réviser ce chapitre. Ne vous découragez pas !":"💪 Ce chapitre nécessite plus d'attention. Reprenez les bases !",s.innerHTML=`\n      <div class="score-display">\n        <div class="score-value">${e}/${n}</div>\n        <div class="score-label">Note obtenue</div>\n        <div class="score-feedback">\n          <p>${a}</p>\n        </div>\n      </div>\n    `,s.style.display="block",t>=6?showNotification(`Bravo ! Note: ${e}/${n}`,"success"):showNotification(`Note: ${e}/${n} - Continuez vos efforts !`,"warning")}async saveStudySession(e,n,t){const s={courseId:this.currentCourse.id,courseName:this.currentCourse.name,chapterTitle:this.currentChapter.title,score:e,percentage:n,totalQuestions:this.currentQuestions.length,results:t,completed:!0,duration:0,createdAt:new Date};try{window.dashboardManager&&await window.dashboardManager.addStudySession(s),await this.updateCourseStats(this.currentCourse.id,e,n)}catch(e){console.error("Erreur lors de la sauvegarde:",e)}}async updateCourseStats(e,n,t){const s=this.courses.find((n=>n.id===e));if(!s)return;const a=s.sessionsCount||0,i=s.averageScore||0,r=0===a?t:Math.round((i*a+t)/(a+1));s.sessionsCount=a+1,s.averageScore=r,s.status="in-progress",s.updatedAt=new Date,window.authManager.saveToLocalStorage("courses",this.courses),this.displayCourses()}closeStudySession(){const e=document.getElementById("study-modal");e&&e.remove(),this.currentCourse=null,this.currentChapter=null,this.currentQuestions=[],this.userAnswers=[]}async deleteCourse(e){if(confirm("Êtes-vous sûr de vouloir supprimer ce cours ?"))try{this.courses=this.courses.filter((n=>n.id!==e)),window.authManager.saveToLocalStorage("courses",this.courses),this.displayCourses(),window.dashboardManager&&window.dashboardManager.loadDashboard(),showNotification("Cours supprimé","info")}catch(e){console.error("Erreur lors de la suppression:",e),showNotification("Erreur lors de la suppression","error")}}setupEventListeners(){document.addEventListener("click",(e=>{e.target.classList.contains("modal")&&"add-course-modal"===e.target.id&&this.closeAddCourseModal()}))}}window.openAddCourseModal=function(){window.coursesManager.openAddCourseModal()},window.closeAddCourseModal=function(){window.coursesManager.closeAddCourseModal()},window.addCourse=function(){window.coursesManager.addCourse()},window.studyCourse=function(e){window.coursesManager.studyCourse(e)},window.deleteCourse=function(e){window.coursesManager.deleteCourse(e)},window.selectChapter=function(e){window.coursesManager.selectChapter(e)},window.closeChapterSelection=function(){window.coursesManager.closeChapterSelection()},window.selectAnswer=function(e,n){window.coursesManager.selectAnswer(e,n)},window.checkAnswers=function(){window.coursesManager.checkAnswers()},window.closeStudySession=function(){window.coursesManager.closeStudySession()},document.addEventListener("DOMContentLoaded",(()=>{window.coursesManager=new CoursesManager})),console.log("Gestionnaire de cours initialisé");class ChatManager{constructor(){this.conversationHistory=[],this.currentSubject="",this.isAITyping=!1,this.init()}init(){this.setupEventListeners(),this.loadConversationHistory()}setupEventListeners(){const e=document.getElementById("chat-input"),n=(document.getElementById("send-message-btn"),document.getElementById("image-upload-btn"),document.getElementById("image-input"));e.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())})),n.addEventListener("change",(e=>{e.target.files[0]&&this.handleImageUpload(e.target.files[0])})),e.addEventListener("input",(()=>{this.adjustInputHeight()}))}adjustInputHeight(){const e=document.getElementById("chat-input");e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}loadConversationHistory(){const e=window.authManager.getFromLocalStorage("chatHistory");e&&(this.conversationHistory=e)}saveConversationHistory(){window.authManager.saveToLocalStorage("chatHistory",this.conversationHistory)}changeSubject(){const e=document.getElementById("chat-subject").value;e!==this.currentSubject&&(this.currentSubject=e,this.conversationHistory=[],this.clearChat(),e?(this.enableChat(),this.addWelcomeMessage(e)):this.disableChat())}enableChat(){const e=document.getElementById("chat-input"),n=document.getElementById("send-message-btn"),t=document.getElementById("image-upload-btn");e.disabled=!1,e.placeholder="Tapez votre question...",n.disabled=!1,t.disabled=!1}disableChat(){const e=document.getElementById("chat-input"),n=document.getElementById("send-message-btn"),t=document.getElementById("image-upload-btn");e.disabled=!0,e.placeholder="Choisissez une matière pour commencer...",n.disabled=!0,t.disabled=!0}clearChat(){document.getElementById("chat-messages").innerHTML=""}addWelcomeMessage(e){const n=`Parfait ! Je suis maintenant spécialisé en ${{programmation:"Programmation",algorithmique:"Algorithmique","bases-donnees":"Bases de données","genie-logiciel":"Génie logiciel",reseaux:"Réseaux",securite:"Sécurité informatique",ia:"Intelligence artificielle",web:"Développement web"}[e]||e}. Posez-moi toutes vos questions sur cette matière. Je suis là pour vous aider à comprendre et apprendre !`;this.addMessage("ai",n)}async sendMessage(){const e=document.getElementById("chat-input"),n=e.value.trim();n&&!this.isAITyping&&(this.currentSubject?(this.addMessage("user",n),e.value="",this.adjustInputHeight(),this.conversationHistory.push({sender:"user",text:n,timestamp:new Date}),await this.getAIResponse(n),this.saveConversationHistory()):showNotification("Veuillez d'abord choisir une matière","warning"))}async getAIResponse(e){try{this.isAITyping=!0,this.showTypingIndicator();const n=await window.aiService.chatResponse(e,this.currentSubject,this.conversationHistory.slice(-10));this.hideTypingIndicator(),this.addMessage("ai",n),this.conversationHistory.push({sender:"ai",text:n,timestamp:new Date}),this.analyzeMessageContent(e,n)}catch(e){console.error("Erreur lors de l'obtention de la réponse IA:",e),this.hideTypingIndicator(),this.addMessage("ai","Désolé, je rencontre des difficultés techniques. Pouvez-vous reformuler votre question ?")}finally{this.isAITyping=!1}}analyzeMessageContent(e,n){const t=e.toLowerCase();["film","série","jeu","sport","musique","politique","météo","cuisine","voyage","célébrité","gossip"].some((e=>t.includes(e)))&&!this.isEducationalContext(e)&&setTimeout((()=>{this.addWarningMessage()}),1e3)}isEducationalContext(e){return["comment","pourquoi","qu'est-ce que","expliquer","comprendre","apprendre","définition","algorithme","programme","code"].some((n=>e.toLowerCase().includes(n)))}addWarningMessage(){const e=`⚠️ Rappel : Je suis conçu pour vous aider dans vos études en ${this.getSubjectName()}. \n                            Concentrons-nous sur des questions éducatives pour maximiser votre apprentissage !`;this.addMessage("ai",e,"warning")}getSubjectName(){return{programmation:"programmation",algorithmique:"algorithmique","bases-donnees":"bases de données","genie-logiciel":"génie logiciel",reseaux:"réseaux",securite:"sécurité informatique",ia:"intelligence artificielle",web:"développement web"}[this.currentSubject]||this.currentSubject}showTypingIndicator(){this.addMessageHTML('\n      <div class="ai-message typing-indicator">\n        <div class="message-avatar">\n          <i class="fas fa-robot"></i>\n        </div>\n        <div class="message-content">\n          <div class="typing-dots">\n            <span></span>\n            <span></span>\n            <span></span>\n          </div>\n        </div>\n      </div>\n    ')}hideTypingIndicator(){const e=document.querySelector(".typing-indicator");e&&e.remove()}addMessage(e,n,t="normal"){const s=document.getElementById("chat-messages"),a="user"===e?'<i class="fas fa-user"></i>':'<i class="fas fa-robot"></i>',i=`\n      <div class="${"user"===e?"user-message":"ai-message"}${"warning"===t?" warning":""}" data-timestamp="${(new Date).toISOString()}">\n        <div class="message-avatar">\n          ${a}\n        </div>\n        <div class="message-content">\n          <p>${this.formatMessage(n)}</p>\n          <span class="message-time">${this.formatTime(new Date)}</span>\n        </div>\n      </div>\n    `;s.insertAdjacentHTML("beforeend",i),this.scrollToBottom()}addMessageHTML(e){document.getElementById("chat-messages").insertAdjacentHTML("beforeend",e),this.scrollToBottom()}formatMessage(e){return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>')}formatTime(e){return e.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}scrollToBottom(){const e=document.getElementById("chat-messages");setTimeout((()=>{e.scrollTop=e.scrollHeight}),100)}uploadImage(){document.getElementById("image-input").click()}async handleImageUpload(e){if(e)if(e.type.startsWith("image/"))if(e.size>5242880)showNotification("L'image est trop volumineuse (max 5MB)","warning");else try{showLoading(!0);const n=await this.fileToBase64(e);this.addImageMessage(n,e.name);const t=await window.aiService.analyzeImage(n.split(",")[1],`Contexte: ${this.getSubjectName()}`);this.addMessage("ai",t),this.conversationHistory.push({sender:"user",text:`[Image envoyée: ${e.name}]`,timestamp:new Date}),this.conversationHistory.push({sender:"ai",text:t,timestamp:new Date}),this.saveConversationHistory()}catch(e){console.error("Erreur lors de l'analyse de l'image:",e),showNotification("Erreur lors de l'analyse de l'image","error")}finally{showLoading(!1),document.getElementById("image-input").value=""}else showNotification("Veuillez sélectionner un fichier image","warning")}fileToBase64(e){return new Promise(((n,t)=>{const s=new FileReader;s.onload=()=>n(s.result),s.onerror=()=>t(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(e)}))}addImageMessage(e,n){const t=document.getElementById("chat-messages"),s=`\n      <div class="user-message" data-timestamp="${(new Date).toISOString()}">\n        <div class="message-avatar">\n          <i class="fas fa-user"></i>\n        </div>\n        <div class="message-content">\n          <div class="image-message">\n            <img src="${e}" alt="${n}" style="max-width: 300px; max-height: 200px; border-radius: 8px;">\n            <p><i class="fas fa-image"></i> ${n}</p>\n          </div>\n          <span class="message-time">${this.formatTime(new Date)}</span>\n        </div>\n      </div>\n    `;t.insertAdjacentHTML("beforeend",s),this.scrollToBottom()}cleanupHistory(){const e=new Date;e.setDate(e.getDate()-7),this.conversationHistory=this.conversationHistory.filter((n=>new Date(n.timestamp)>e)),this.saveConversationHistory()}exportConversation(){const e=this.conversationHistory.map((e=>`[${this.formatTime(new Date(e.timestamp))}] ${e.sender.toUpperCase()}: ${e.text}`)).join("\n"),n=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=`conversation_${this.currentSubject}_${(new Date).toISOString().split("T")[0]}.txt`,s.click(),URL.revokeObjectURL(t),showNotification("Conversation exportée","success")}}window.changeChatSubject=function(){window.chatManager.changeSubject()},window.sendMessage=function(){window.chatManager.sendMessage()},window.uploadImage=function(){window.chatManager.uploadImage()};const chatStyles=document.createElement("style");chatStyles.textContent="\n  .chat-container {\n    display: flex;\n    flex-direction: column;\n    height: 600px;\n    background: var(--white);\n    border-radius: var(--radius-lg);\n    box-shadow: var(--shadow);\n    overflow: hidden;\n  }\n  \n  .chat-messages {\n    flex: 1;\n    padding: var(--spacing-4);\n    overflow-y: auto;\n    background: var(--gray-50);\n  }\n  \n  .user-message, .ai-message {\n    display: flex;\n    gap: var(--spacing-3);\n    margin-bottom: var(--spacing-4);\n    animation: messageSlide 0.3s ease-out;\n  }\n  \n  .user-message {\n    flex-direction: row-reverse;\n  }\n  \n  .message-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: var(--radius-full);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--white);\n    flex-shrink: 0;\n  }\n  \n  .user-message .message-avatar {\n    background: var(--primary);\n  }\n  \n  .ai-message .message-avatar {\n    background: var(--secondary);\n  }\n  \n  .message-content {\n    max-width: 70%;\n    padding: var(--spacing-3) var(--spacing-4);\n    border-radius: var(--radius-lg);\n    position: relative;\n  }\n  \n  .user-message .message-content {\n    background: var(--primary);\n    color: var(--white);\n    border-bottom-right-radius: var(--radius-sm);\n  }\n  \n  .ai-message .message-content {\n    background: var(--white);\n    border: 1px solid var(--gray-200);\n    border-bottom-left-radius: var(--radius-sm);\n  }\n  \n  .ai-message.warning .message-content {\n    border-color: var(--warning);\n    background: var(--warning);\n    color: var(--white);\n  }\n  \n  .message-time {\n    font-size: var(--font-size-xs);\n    opacity: 0.7;\n    display: block;\n    margin-top: var(--spacing-1);\n  }\n  \n  .chat-input-container {\n    padding: var(--spacing-4);\n    background: var(--white);\n    border-top: 1px solid var(--gray-200);\n  }\n  \n  .chat-input-wrapper {\n    display: flex;\n    gap: var(--spacing-2);\n    align-items: flex-end;\n  }\n  \n  #chat-input {\n    flex: 1;\n    padding: var(--spacing-3);\n    border: 2px solid var(--gray-200);\n    border-radius: var(--radius);\n    font-family: inherit;\n    resize: none;\n    min-height: 40px;\n    max-height: 120px;\n  }\n  \n  #chat-input:focus {\n    outline: none;\n    border-color: var(--primary);\n  }\n  \n  .image-btn, .send-btn {\n    padding: var(--spacing-3);\n    border: none;\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: var(--transition);\n  }\n  \n  .image-btn {\n    background: var(--gray-200);\n    color: var(--gray-600);\n  }\n  \n  .send-btn {\n    background: var(--primary);\n    color: var(--white);\n  }\n  \n  .send-btn:disabled {\n    background: var(--gray-300);\n    cursor: not-allowed;\n  }\n  \n  .image-btn:hover:not(:disabled) {\n    background: var(--gray-300);\n  }\n  \n  .send-btn:hover:not(:disabled) {\n    background: var(--primary-dark);\n  }\n  \n  .typing-indicator .typing-dots {\n    display: flex;\n    gap: var(--spacing-1);\n  }\n  \n  .typing-dots span {\n    width: 8px;\n    height: 8px;\n    background: var(--gray-400);\n    border-radius: var(--radius-full);\n    animation: typingBounce 1.4s infinite both;\n  }\n  \n  .typing-dots span:nth-child(2) {\n    animation-delay: 0.2s;\n  }\n  \n  .typing-dots span:nth-child(3) {\n    animation-delay: 0.4s;\n  }\n  \n  .image-message img {\n    display: block;\n    margin-bottom: var(--spacing-2);\n    border-radius: var(--radius);\n  }\n  \n  .subject-selector select {\n    padding: var(--spacing-2) var(--spacing-3);\n    border: 2px solid var(--gray-200);\n    border-radius: var(--radius);\n    background: var(--white);\n    cursor: pointer;\n  }\n  \n  @keyframes messageSlide {\n    from {\n      opacity: 0;\n      transform: translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  \n  @keyframes typingBounce {\n    0%, 80%, 100% {\n      transform: scale(0);\n    }\n    40% {\n      transform: scale(1);\n    }\n  }\n  \n  @media (max-width: 768px) {\n    .message-content {\n      max-width: 85%;\n    }\n    \n    .chat-container {\n      height: 500px;\n    }\n  }\n",document.head.appendChild(chatStyles),document.addEventListener("DOMContentLoaded",(()=>{window.chatManager=new ChatManager})),console.log("Gestionnaire de chat initialisé");class ScheduleManager{constructor(){this.currentSchedule=null,this.scheduledNotifications=[],this.userPreferences={},this.init()}async init(){this.loadUserPreferences(),await this.loadCurrentSchedule(),this.setupEventListeners(),this.scheduleNotifications()}loadUserPreferences(){this.userPreferences=window.authManager.getFromLocalStorage("userPreferences")||{availability:"Après 18h",bedtime:"23:00",wakeup:"07:00",studyDuration:60,preferredDays:["lundi","mardi","mercredi","jeudi","vendredi","samedi"],breakDuration:15,maxSessionsPerDay:2}}saveUserPreferences(){window.authManager.saveToLocalStorage("userPreferences",this.userPreferences)}async loadCurrentSchedule(){try{window.authManager.getCurrentUserId()&&(this.currentSchedule=await window.FirebaseUtils.getSchedule(window.authManager.getCurrentUserId())),this.currentSchedule||(this.currentSchedule=window.authManager.getFromLocalStorage("weeklySchedule")),this.displaySchedule()}catch(e){console.error("Erreur lors du chargement du planning:",e)}}displaySchedule(){const e=document.getElementById("schedule-grid");if(!this.currentSchedule)return void(e.innerHTML='\n        <div class="no-data">\n          <i class="fas fa-calendar-alt" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>\n          <p>Aucun planning généré. Cliquez sur "Générer nouveau planning" pour créer votre planning de la semaine</p>\n        </div>\n      ');const n={lundi:"Lundi",mardi:"Mardi",mercredi:"Mercredi",jeudi:"Jeudi",vendredi:"Vendredi",samedi:"Samedi"},t=["lundi","mardi","mercredi","jeudi","vendredi","samedi"].map((e=>{const t=this.currentSchedule[e]||[];return`\n        <div class="schedule-day">\n          <div class="schedule-day-header">\n            <h3>${n[e]}</h3>\n            <span class="sessions-count">${t.length} session(s)</span>\n          </div>\n          <div class="schedule-sessions">\n            ${t.length>0?t.map((n=>this.renderSession(n,e))).join(""):'<p class="no-sessions">Journée libre</p>'}\n          </div>\n        </div>\n      `})).join("");e.innerHTML=`<div class="schedule-week">${t}</div>`,this.updateSessionStates()}renderSession(e,n){const t=new Date,s=new Date,[a,i]=e.time.split(":");s.setHours(parseInt(a),parseInt(i),0,0);let r="",o="";return e.completed?(r="completed",o='<i class="fas fa-check-circle"></i>'):s<t?(r="missed",o='<i class="fas fa-times-circle"></i>'):(r="upcoming",o='<i class="fas fa-clock"></i>'),`\n      <div class="schedule-session ${r}" data-day="${n}" data-time="${e.time}">\n        <div class="session-time">\n          ${o}\n          <span>${e.time}</span>\n        </div>\n        <div class="session-content">\n          <div class="session-subject">${e.subject}</div>\n          <div class="session-type">${this.getTypeLabel(e.type)} • ${e.duration}min</div>\n        </div>\n        <div class="session-actions">\n          ${this.renderSessionActions(e,n,r)}\n        </div>\n      </div>\n    `}getTypeLabel(e){return{revision:"Révision",exercices:"Exercices",etude:"Étude",pratique:"Pratique"}[e]||"Étude"}renderSessionActions(e,n,t){if("completed"===t)return'<span class="status-text completed">Terminée ✓</span>';if("missed"===t)return'<span class="status-text missed">Manquée ✗</span>';const s=new Date,a=new Date,[i,r]=e.time.split(":");a.setHours(parseInt(i),parseInt(r),0,0);const o=a-s;return Math.abs(o)<18e5?`\n        <button class="btn primary btn-sm" onclick="completeSession('${n}', '${e.time}')">\n          <i class="fas fa-check"></i>\n          Marquer terminée\n        </button>\n      `:'<span class="status-text upcoming">À venir</span>'}updateSessionStates(){const e=new Date;Object.keys(this.currentSchedule||{}).forEach((n=>{this.currentSchedule[n].forEach((n=>{const t=new Date,[s,a]=n.time.split(":");t.setHours(parseInt(s),parseInt(a),0,0);const i=new Date(t-6e5);i>e&&!n.completed&&!n.notificationSent&&this.scheduleSessionNotification(n,i)}))}))}scheduleSessionNotification(e,n){const t=n-new Date;if(t>0){const s=setTimeout((()=>{this.sendSessionNotification(e),e.notificationSent=!0,this.saveCurrentSchedule()}),t);this.scheduledNotifications.push({timeoutId:s,session:e,notificationTime:n})}}sendSessionNotification(e){window.notificationManager&&window.notificationManager.scheduleStudyReminder(10),showNotification(`Votre session de ${e.subject} commence dans 10 minutes !`,"info",8e3)}async generateWeeklySchedule(){try{showLoading(!0),this.userPreferences.availability||await this.collectUserPreferences();const e=window.coursesManager?window.coursesManager.courses:[],n=window.dashboardManager?window.dashboardManager.weakSubjects.map((e=>e.subject)):[],t=await window.aiService.generateWeeklySchedule(this.userPreferences,e,n);this.currentSchedule=t,await this.saveCurrentSchedule(),this.displaySchedule(),this.scheduleNotifications(),showNotification("Nouveau planning généré avec succès !","success")}catch(e){console.error("Erreur lors de la génération du planning:",e),showNotification("Erreur lors de la génération du planning","error")}finally{showLoading(!1)}}async collectUserPreferences(){return new Promise((e=>{const n=document.createElement("div");n.className="modal active",n.style.display="flex",n.id="preferences-modal",n.innerHTML='\n        <div class="modal-content">\n          <div class="modal-header">\n            <h2>Configurez vos préférences d\'étude</h2>\n          </div>\n          <div class="modal-body">\n            <div class="input-group">\n              <label>Quand êtes-vous généralement disponible pour étudier ?</label>\n              <select id="pref-availability">\n                <option value="Matin (7h-12h)">Matin (7h-12h)</option>\n                <option value="Après-midi (12h-18h)">Après-midi (12h-18h)</option>\n                <option value="Soirée (18h-23h)" selected>Soirée (18h-23h)</option>\n                <option value="Flexible">Flexible</option>\n              </select>\n            </div>\n            \n            <div class="input-group">\n              <label>À quelle heure vous couchez-vous généralement ?</label>\n              <input type="time" id="pref-bedtime" value="23:00">\n            </div>\n            \n            <div class="input-group">\n              <label>À quelle heure vous levez-vous ?</label>\n              <input type="time" id="pref-wakeup" value="07:00">\n            </div>\n            \n            <div class="input-group">\n              <label>Durée préférée par session d\'étude (minutes)</label>\n              <select id="pref-duration">\n                <option value="30">30 minutes</option>\n                <option value="45">45 minutes</option>\n                <option value="60" selected>1 heure</option>\n                <option value="90">1h30</option>\n              </select>\n            </div>\n            \n            <div class="input-group">\n              <label>Combien de sessions par jour maximum ?</label>\n              <select id="pref-max-sessions">\n                <option value="1">1 session</option>\n                <option value="2" selected>2 sessions</option>\n                <option value="3">3 sessions</option>\n              </select>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button class="btn primary" onclick="savePreferences()">\n              <i class="fas fa-save"></i>\n              Enregistrer et continuer\n            </button>\n          </div>\n        </div>\n      ',document.body.appendChild(n),window.savePreferences=()=>{this.userPreferences.availability=document.getElementById("pref-availability").value,this.userPreferences.bedtime=document.getElementById("pref-bedtime").value,this.userPreferences.wakeup=document.getElementById("pref-wakeup").value,this.userPreferences.studyDuration=parseInt(document.getElementById("pref-duration").value),this.userPreferences.maxSessionsPerDay=parseInt(document.getElementById("pref-max-sessions").value),this.saveUserPreferences(),n.remove(),delete window.savePreferences,e()}}))}async saveCurrentSchedule(){try{window.authManager.saveToLocalStorage("weeklySchedule",this.currentSchedule),window.authManager.getCurrentUserId()&&await window.FirebaseUtils.saveSchedule(window.authManager.getCurrentUserId(),this.currentSchedule)}catch(e){console.error("Erreur lors de la sauvegarde du planning:",e)}}async completeSession(e,n){if(!this.currentSchedule||!this.currentSchedule[e])return;const t=this.currentSchedule[e].find((e=>e.time===n));if(!t)return;const s=new Date,a=new Date,[i,r]=n.split(":");a.setHours(parseInt(i),parseInt(r),0,0);const o=Math.abs(s-a)/6e4;if(o<20)showNotification("Trop tôt ! Attendez au moins 20 minutes avant de valider.","warning");else if(o>t.duration+15)showNotification("Trop tard ! La session devrait être validée dans les 15 minutes suivant la fin.","warning");else{if(t.completed=!0,t.completedAt=new Date,await this.saveCurrentSchedule(),window.dashboardManager){const e={subject:t.subject,type:t.type,duration:t.duration,completed:!0,scheduledTime:a,completedAt:new Date,source:"schedule"};await window.dashboardManager.addStudySession(e)}this.displaySchedule(),showNotification("Session validée ! Bravo pour votre assiduité !","success")}}scheduleNotifications(){this.scheduledNotifications.forEach((e=>{clearTimeout(e.timeoutId)})),this.scheduledNotifications=[],this.updateSessionStates()}setupEventListeners(){setInterval((()=>{this.currentSchedule&&this.displaySchedule()}),6e4),this.scheduleDailyCheck()}scheduleDailyCheck(){const e=new Date,n=new Date(e);n.setDate(n.getDate()+1),n.setHours(0,0,0,0);setTimeout((()=>{this.performDailyCheck(),setInterval((()=>{this.performDailyCheck()}),864e5)}),n-e)}performDailyCheck(){const e=new Date;e.setDate(e.getDate()-1);const n=e.toLocaleDateString("fr-FR",{weekday:"long"}).toLowerCase();if(this.currentSchedule&&this.currentSchedule[n]){const e=this.currentSchedule[n].filter((e=>!e.completed));e.length>0&&this.sendMissedSessionWarning(e.length)}0===e.getDay()&&this.autoRegenerateSchedule()}sendMissedSessionWarning(e){const n=1===e?"Vous avez manqué 1 session d'étude hier. Rattrapez-vous aujourd'hui !":`Vous avez manqué ${e} sessions d'étude hier. La régularité est importante !`;showNotification(n,"warning",1e4),window.notificationManager&&window.notificationManager.showBrowserNotification("StudyAI - Sessions manquées",n)}async autoRegenerateSchedule(){try{showNotification("Génération automatique du planning de la semaine...","info"),await this.generateWeeklySchedule()}catch(e){console.error("Erreur lors de la régénération automatique:",e)}}getScheduleStats(){if(!this.currentSchedule)return null;let e=0,n=0,t=0;return Object.values(this.currentSchedule).forEach((s=>{s.forEach((s=>{e++,t+=s.duration,s.completed&&n++}))})),{totalSessions:e,completedSessions:n,missedSessions:e-n,completionRate:e>0?Math.round(n/e*100):0,totalDuration:t}}}window.generateWeeklySchedule=function(){window.scheduleManager.generateWeeklySchedule()},window.completeSession=function(e,n){window.scheduleManager.completeSession(e,n)};const scheduleStyles=document.createElement("style");scheduleStyles.textContent="\n  .schedule-week {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: var(--spacing-4);\n  }\n  \n  .schedule-day {\n    background: var(--white);\n    border-radius: var(--radius-lg);\n    box-shadow: var(--shadow);\n    overflow: hidden;\n  }\n  \n  .schedule-day-header {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: var(--white);\n    padding: var(--spacing-4);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  \n  .schedule-day-header h3 {\n    margin: 0;\n    color: var(--white);\n  }\n  \n  .sessions-count {\n    font-size: var(--font-size-sm);\n    opacity: 0.9;\n  }\n  \n  .schedule-sessions {\n    padding: var(--spacing-4);\n  }\n  \n  .no-sessions {\n    text-align: center;\n    color: var(--gray-500);\n    font-style: italic;\n    padding: var(--spacing-6) 0;\n  }\n  \n  .schedule-session {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-3);\n    padding: var(--spacing-3);\n    border-radius: var(--radius);\n    margin-bottom: var(--spacing-3);\n    border-left: 4px solid transparent;\n    transition: var(--transition);\n  }\n  \n  .schedule-session:hover {\n    background: var(--gray-50);\n  }\n  \n  .schedule-session.upcoming {\n    border-left-color: var(--info);\n    background: var(--info);\n    background-opacity: 0.1;\n  }\n  \n  .schedule-session.completed {\n    border-left-color: var(--success);\n    background: rgba(16, 185, 129, 0.1);\n  }\n  \n  .schedule-session.missed {\n    border-left-color: var(--danger);\n    background: rgba(239, 68, 68, 0.1);\n  }\n  \n  .session-time {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-2);\n    min-width: 80px;\n    font-weight: 600;\n  }\n  \n  .session-time i {\n    font-size: var(--font-size-sm);\n  }\n  \n  .session-content {\n    flex: 1;\n  }\n  \n  .session-subject {\n    font-weight: 600;\n    color: var(--gray-800);\n    margin-bottom: var(--spacing-1);\n  }\n  \n  .session-type {\n    font-size: var(--font-size-sm);\n    color: var(--gray-600);\n  }\n  \n  .session-actions {\n    display: flex;\n    align-items: center;\n  }\n  \n  .btn-sm {\n    padding: var(--spacing-2) var(--spacing-3);\n    font-size: var(--font-size-sm);\n  }\n  \n  .status-text {\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    padding: var(--spacing-1) var(--spacing-3);\n    border-radius: var(--radius-full);\n  }\n  \n  .status-text.upcoming {\n    color: var(--info);\n    background: rgba(59, 130, 246, 0.1);\n  }\n  \n  .status-text.completed {\n    color: var(--success);\n    background: rgba(16, 185, 129, 0.1);\n  }\n  \n  .status-text.missed {\n    color: var(--danger);\n    background: rgba(239, 68, 68, 0.1);\n  }\n  \n  @media (max-width: 768px) {\n    .schedule-week {\n      grid-template-columns: 1fr;\n    }\n    \n    .schedule-session {\n      flex-direction: column;\n      align-items: stretch;\n      gap: var(--spacing-2);\n    }\n    \n    .session-time {\n      min-width: auto;\n    }\n  }\n",document.head.appendChild(scheduleStyles),document.addEventListener("DOMContentLoaded",(()=>{window.scheduleManager=new ScheduleManager})),console.log("Gestionnaire de planning initialisé");class SocialManager{constructor(){this.friends=[],this.users=[],this.invitations=[],this.groupChats=[],this.activeTab="friends",this.init()}async init(){this.setupEventListeners(),await this.loadSocialData()}setupEventListeners(){document.querySelectorAll(".social-tab").forEach((e=>{e.addEventListener("click",(()=>{this.switchTab(e.dataset.tab)}))}));const e=document.querySelector("#users-tab .btn");e&&e.addEventListener("click",(()=>{this.searchUsers()}));const n=document.getElementById("user-search");n&&n.addEventListener("keypress",(e=>{"Enter"===e.key&&this.searchUsers()}))}switchTab(e){this.activeTab=e,document.querySelectorAll(".social-tab").forEach((n=>{n.classList.remove("active"),n.dataset.tab===e&&n.classList.add("active")})),document.querySelectorAll(".social-tab-content").forEach((n=>{n.classList.remove("active"),n.id===`${e}-tab`&&n.classList.add("active")})),this.loadTabContent(e)}async loadTabContent(e){switch(e){case"friends":await this.loadFriends();break;case"users":this.displayUserSearch();break;case"invitations":await this.loadInvitations()}}async loadSocialData(){try{await this.loadFriends(),await this.loadInvitations()}catch(e){console.error("Erreur lors du chargement des données sociales:",e)}}async loadFriends(){try{this.friends=window.authManager.getFromLocalStorage("friends")||[],this.displayFriends()}catch(e){console.error("Erreur lors du chargement des amis:",e),this.displayFriends()}}displayFriends(){const e=document.getElementById("friends-list");if(0===this.friends.length)return void(e.innerHTML='\n        <div class="no-data">\n          <i class="fas fa-user-friends" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>\n          <p>Aucun ami ajouté. Envoyez des invitations pour étudier ensemble !</p>\n        </div>\n      ');const n=this.friends.map((e=>`\n      <div class="friend-item">\n        <div class="friend-avatar">\n          <i class="fas fa-user"></i>\n        </div>\n        <div class="friend-info">\n          <div class="friend-name">${e.name}</div>\n          <div class="friend-status">${e.status||"Hors ligne"}</div>\n          <div class="friend-level">${e.level||"L2"} - Génie Logiciel</div>\n        </div>\n        <div class="friend-actions">\n          <button class="btn primary btn-sm" onclick="startGroupChat('${e.id}')">\n            <i class="fas fa-comments"></i>\n            Chat\n          </button>\n          <button class="btn secondary btn-sm" onclick="removeFriend('${e.id}')">\n            <i class="fas fa-user-times"></i>\n            Retirer\n          </button>\n        </div>\n      </div>\n    `)).join("");e.innerHTML=n}displayUserSearch(){const e=document.getElementById("users-list");if(0===this.users.length)return void(e.innerHTML='\n        <div class="no-data">\n          <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>\n          <p>Utilisez la recherche pour trouver d\'autres étudiants</p>\n        </div>\n      ');const n=this.users.map((e=>`\n      <div class="user-item">\n        <div class="user-avatar">\n          <i class="fas fa-user"></i>\n        </div>\n        <div class="user-info">\n          <div class="user-name">${e.name}</div>\n          <div class="user-level">${e.level||"L2"} - Génie Logiciel</div>\n          <div class="user-joined">Membre depuis ${this.formatDate(e.createdAt)}</div>\n        </div>\n        <div class="user-actions">\n          <button class="btn primary btn-sm" onclick="sendFriendInvitation('${e.id}')">\n            <i class="fas fa-user-plus"></i>\n            Inviter\n          </button>\n        </div>\n      </div>\n    `)).join("");e.innerHTML=n}async searchUsers(){const e=document.getElementById("user-search").value.trim();if(e)try{showLoading(!0),window.authManager.getCurrentUserId()?this.users=await window.FirebaseUtils.searchUsers(e,window.authManager.getCurrentUserId()):this.users=this.generateMockUsers(e),this.displayUserSearch(),0===this.users.length&&showNotification("Aucun utilisateur trouvé","info")}catch(e){console.error("Erreur lors de la recherche:",e),showNotification("Erreur lors de la recherche","error")}finally{showLoading(!1)}else showNotification("Veuillez saisir un terme de recherche","warning")}generateMockUsers(e){return[{id:"1",name:"Marie Dubois",level:"L2",createdAt:new Date("2024-09-01")},{id:"2",name:"Pierre Martin",level:"L3",createdAt:new Date("2024-08-15")},{id:"3",name:"Sophie Laurent",level:"L2",createdAt:new Date("2024-09-10")},{id:"4",name:"Thomas Bernard",level:"M1",createdAt:new Date("2024-07-20")},{id:"5",name:"Emma Rousseau",level:"L2",createdAt:new Date("2024-09-05")}].filter((n=>n.name.toLowerCase().includes(e.toLowerCase())))}async sendFriendInvitation(e){try{const n=this.users.find((n=>n.id===e));if(!n)return;if(this.invitations.find((n=>n.to===e&&"pending"===n.status)))return void showNotification("Invitation déjà envoyée à cet utilisateur","warning");const t={id:Date.now().toString(),from:window.authManager.getCurrentUserId(),to:e,toName:n.name,fromName:window.authManager.getFromLocalStorage("userData").name||"Vous",status:"pending",createdAt:new Date},s=window.authManager.getFromLocalStorage("sentInvitations")||[];s.push(t),window.authManager.saveToLocalStorage("sentInvitations",s),window.authManager.getCurrentUserId()&&await window.FirebaseUtils.sendFriendRequest(window.authManager.getCurrentUserId(),e),showNotification(`Invitation envoyée à ${n.name}`,"success")}catch(e){console.error("Erreur lors de l'envoi de l'invitation:",e),showNotification("Erreur lors de l'envoi de l'invitation","error")}}async loadInvitations(){try{if(this.invitations=window.authManager.getFromLocalStorage("receivedInvitations")||[],window.authManager.getCurrentUserId()){const e=await window.FirebaseUtils.getFriendRequests(window.authManager.getCurrentUserId());this.invitations=[...this.invitations,...e]}this.displayInvitations()}catch(e){console.error("Erreur lors du chargement des invitations:",e),this.displayInvitations()}}displayInvitations(){const e=document.getElementById("invitations-list");if(0===this.invitations.length)return void(e.innerHTML='\n        <div class="no-data">\n          <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>\n          <p>Aucune invitation en attente</p>\n        </div>\n      ');const n=this.invitations.map((e=>`\n      <div class="invitation-item">\n        <div class="invitation-avatar">\n          <i class="fas fa-user"></i>\n        </div>\n        <div class="invitation-info">\n          <div class="invitation-from">\n            <strong>${e.fromName}</strong> vous a envoyé une invitation\n          </div>\n          <div class="invitation-date">\n            ${this.formatDate(e.createdAt)}\n          </div>\n        </div>\n        <div class="invitation-actions">\n          <button class="btn success btn-sm" onclick="acceptInvitation('${e.id}')">\n            <i class="fas fa-check"></i>\n            Accepter\n          </button>\n          <button class="btn danger btn-sm" onclick="rejectInvitation('${e.id}')">\n            <i class="fas fa-times"></i>\n            Refuser\n          </button>\n        </div>\n      </div>\n    `)).join("");e.innerHTML=n}async acceptInvitation(e){try{const n=this.invitations.find((n=>n.id===e));if(!n)return;const t={id:n.from,name:n.fromName,status:"En ligne",addedAt:new Date};this.friends.push(t),window.authManager.saveToLocalStorage("friends",this.friends),this.invitations=this.invitations.filter((n=>n.id!==e)),window.authManager.saveToLocalStorage("receivedInvitations",this.invitations),this.createGroupChat(t),this.displayInvitations(),"friends"===this.activeTab&&this.displayFriends(),showNotification(`Vous êtes maintenant ami avec ${n.fromName}`,"success"),window.notificationManager&&setTimeout((()=>{window.notificationManager.show(`${n.fromName} a accepté votre invitation !`,"success")}),2e3)}catch(e){console.error("Erreur lors de l'acceptation:",e),showNotification("Erreur lors de l'acceptation","error")}}async rejectInvitation(e){try{this.invitations=this.invitations.filter((n=>n.id!==e)),window.authManager.saveToLocalStorage("receivedInvitations",this.invitations),this.displayInvitations(),showNotification("Invitation refusée","info")}catch(e){console.error("Erreur lors du refus:",e),showNotification("Erreur lors du refus","error")}}createGroupChat(e){const n={id:`chat_${Date.now()}`,participants:[window.authManager.getCurrentUserId(),e.id],participantNames:[window.authManager.getFromLocalStorage("userData").name||"Vous",e.name],messages:[],createdAt:new Date,isActive:!0};this.groupChats.push(n),window.authManager.saveToLocalStorage("groupChats",this.groupChats)}startGroupChat(e){const n=this.friends.find((n=>n.id===e));if(!n)return;let t=this.groupChats.find((n=>n.participants.includes(e)&&n.isActive));t||(this.createGroupChat(n),t=this.groupChats[this.groupChats.length-1]),this.openGroupChatModal(t)}openGroupChatModal(e){const n=document.createElement("div");n.className="modal active",n.style.display="flex",n.id="group-chat-modal",n.innerHTML=`\n      <div class="modal-content" style="max-width: 600px; height: 70vh;">\n        <div class="modal-header">\n          <h2>Chat avec ${e.participantNames.filter((e=>"Vous"!==e)).join(", ")}</h2>\n          <button class="close-btn" onclick="closeGroupChat()">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="modal-body" style="padding: 0; display: flex; flex-direction: column; height: 100%;">\n          <div class="group-chat-messages" id="group-chat-messages" style="flex: 1; overflow-y: auto; padding: 1rem;">\n            ${this.renderChatMessages(e)}\n          </div>\n          <div class="group-chat-input" style="padding: 1rem; border-top: 1px solid var(--gray-200);">\n            <div class="chat-input-wrapper">\n              <input type="text" id="group-message-input" placeholder="Tapez votre message éducatif..." style="flex: 1;">\n              <button class="btn primary" onclick="sendGroupMessage('${e.id}')">\n                <i class="fas fa-paper-plane"></i>\n              </button>\n            </div>\n            <div class="chat-warning" style="font-size: 0.8rem; color: var(--warning); margin-top: 0.5rem;">\n              <i class="fas fa-exclamation-triangle"></i>\n              L'IA surveille ce chat. Gardez vos discussions éducatives !\n            </div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(n),document.getElementById("group-message-input").focus(),document.getElementById("group-message-input").addEventListener("keypress",(n=>{"Enter"===n.key&&this.sendGroupMessage(e.id)}))}renderChatMessages(e){return 0===e.messages.length?'\n        <div class="chat-welcome">\n          <p>🎓 Bienvenue dans votre espace d\'étude collaboratif !</p>\n          <p>Partagez vos questions, explications et découvertes sur vos cours.</p>\n        </div>\n      ':e.messages.map((e=>`\n      <div class="group-message ${e.fromUser?"user":"friend"}">\n        <div class="message-author">${e.authorName}</div>\n        <div class="message-text">${e.text}</div>\n        <div class="message-time">${this.formatTime(new Date(e.timestamp))}</div>\n      </div>\n    `)).join("")}sendGroupMessage(e){const n=document.getElementById("group-message-input"),t=n.value.trim();if(!t)return;const s=this.groupChats.find((n=>n.id===e));if(!s)return;if(!this.isEducationalMessage(t))return void this.showChatWarning();const a={id:Date.now().toString(),text:t,authorName:window.authManager.getFromLocalStorage("userData").name||"Vous",fromUser:!0,timestamp:new Date};s.messages.push(a),window.authManager.saveToLocalStorage("groupChats",this.groupChats),n.value="",document.getElementById("group-chat-messages").innerHTML=this.renderChatMessages(s),this.scrollChatToBottom(),setTimeout((()=>{this.simulateFriendResponse(s)}),1e3+3e3*Math.random())}isEducationalMessage(e){const n=e.toLowerCase(),t=["film","série","jeu","sport","musique","fête","sortie","personnel","privé","gossip","ragot"].some((e=>n.includes(e))),s=["cours","exercice","projet","algorithme","programmation","base de données","question","comprendre","expliquer","révision","exam","devoir"].some((e=>n.includes(e)));return!t||s}showChatWarning(){showNotification("⚠️ Gardez vos discussions éducatives et liées aux études !","warning"),window.notificationManager&&window.notificationManager.warnNonEducationalContent()}simulateFriendResponse(e){const n=["Bonne question ! J'ai eu le même problème.","Je pense qu'il faut revoir cette partie du cours.","Tu as regardé les exercices du TD ?","L'explication du prof était claire sur ce point.","On pourrait réviser ensemble ce chapitre.","J'ai trouvé une bonne ressource sur ce sujet.","Il faut qu'on travaille plus sur cette matière."],t=n[Math.floor(Math.random()*n.length)],s=e.participantNames.find((e=>"Vous"!==e)),a={id:Date.now().toString(),text:t,authorName:s,fromUser:!1,timestamp:new Date};e.messages.push(a),window.authManager.saveToLocalStorage("groupChats",this.groupChats);const i=document.getElementById("group-chat-messages");i&&(i.innerHTML=this.renderChatMessages(e),this.scrollChatToBottom())}scrollChatToBottom(){const e=document.getElementById("group-chat-messages");e&&(e.scrollTop=e.scrollHeight)}closeGroupChat(){const e=document.getElementById("group-chat-modal");e&&e.remove()}async removeFriend(e){if(confirm("Êtes-vous sûr de vouloir retirer cet ami ?"))try{this.friends=this.friends.filter((n=>n.id!==e)),window.authManager.saveToLocalStorage("friends",this.friends),this.groupChats.forEach((n=>{n.participants.includes(e)&&(n.isActive=!1)})),window.authManager.saveToLocalStorage("groupChats",this.groupChats),this.displayFriends(),showNotification("Ami retiré","info")}catch(e){console.error("Erreur lors de la suppression:",e),showNotification("Erreur lors de la suppression","error")}}formatDate(e){return new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}formatTime(e){return e.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}}window.searchUsers=function(){window.socialManager.searchUsers()},window.sendFriendInvitation=function(e){window.socialManager.sendFriendInvitation(e)},window.acceptInvitation=function(e){window.socialManager.acceptInvitation(e)},window.rejectInvitation=function(e){window.socialManager.rejectInvitation(e)},window.startGroupChat=function(e){window.socialManager.startGroupChat(e)},window.removeFriend=function(e){window.socialManager.removeFriend(e)},window.closeGroupChat=function(){window.socialManager.closeGroupChat()},window.sendGroupMessage=function(e){window.socialManager.sendGroupMessage(e)};const socialStyles=document.createElement("style");socialStyles.textContent="\n  .social-tabs {\n    display: flex;\n    gap: var(--spacing-2);\n    margin-bottom: var(--spacing-4);\n  }\n  \n  .social-tab {\n    padding: var(--spacing-3) var(--spacing-5);\n    border: 2px solid var(--gray-200);\n    background: var(--white);\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: var(--transition);\n    font-weight: 500;\n  }\n  \n  .social-tab.active {\n    border-color: var(--primary);\n    background: var(--primary);\n    color: var(--white);\n  }\n  \n  .social-tab-content {\n    display: none;\n  }\n  \n  .social-tab-content.active {\n    display: block;\n  }\n  \n  .friend-item, .user-item, .invitation-item {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-4);\n    padding: var(--spacing-4);\n    background: var(--white);\n    border-radius: var(--radius);\n    box-shadow: var(--shadow-sm);\n    margin-bottom: var(--spacing-3);\n    transition: var(--transition);\n  }\n  \n  .friend-item:hover, .user-item:hover, .invitation-item:hover {\n    box-shadow: var(--shadow);\n    transform: translateY(-1px);\n  }\n  \n  .friend-avatar, .user-avatar, .invitation-avatar {\n    width: 50px;\n    height: 50px;\n    background: var(--primary-light);\n    border-radius: var(--radius-full);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--primary);\n    font-size: var(--font-size-lg);\n    flex-shrink: 0;\n  }\n  \n  .friend-info, .user-info, .invitation-info {\n    flex: 1;\n  }\n  \n  .friend-name, .user-name {\n    font-weight: 600;\n    color: var(--gray-800);\n    margin-bottom: var(--spacing-1);\n  }\n  \n  .friend-status {\n    font-size: var(--font-size-sm);\n    color: var(--success);\n    margin-bottom: var(--spacing-1);\n  }\n  \n  .friend-level, .user-level {\n    font-size: var(--font-size-sm);\n    color: var(--gray-600);\n  }\n  \n  .user-joined, .invitation-date {\n    font-size: var(--font-size-sm);\n    color: var(--gray-500);\n  }\n  \n  .friend-actions, .user-actions, .invitation-actions {\n    display: flex;\n    gap: var(--spacing-2);\n    flex-shrink: 0;\n  }\n  \n  .users-search {\n    display: flex;\n    gap: var(--spacing-3);\n    margin-bottom: var(--spacing-4);\n  }\n  \n  .users-search input {\n    flex: 1;\n    padding: var(--spacing-3);\n    border: 2px solid var(--gray-200);\n    border-radius: var(--radius);\n  }\n  \n  .users-search input:focus {\n    outline: none;\n    border-color: var(--primary);\n  }\n  \n  .btn.success {\n    background: var(--success);\n    color: var(--white);\n  }\n  \n  .btn.success:hover {\n    background: var(--success-dark, #059669);\n  }\n  \n  .group-chat-messages {\n    background: var(--gray-50);\n  }\n  \n  .chat-welcome {\n    text-align: center;\n    padding: var(--spacing-8);\n    color: var(--gray-600);\n  }\n  \n  .group-message {\n    margin-bottom: var(--spacing-4);\n    max-width: 70%;\n  }\n  \n  .group-message.user {\n    margin-left: auto;\n    text-align: right;\n  }\n  \n  .message-author {\n    font-size: var(--font-size-sm);\n    font-weight: 600;\n    color: var(--gray-600);\n    margin-bottom: var(--spacing-1);\n  }\n  \n  .group-message.user .message-author {\n    color: var(--primary);\n  }\n  \n  .message-text {\n    padding: var(--spacing-3);\n    border-radius: var(--radius);\n    background: var(--white);\n    border: 1px solid var(--gray-200);\n    word-wrap: break-word;\n  }\n  \n  .group-message.user .message-text {\n    background: var(--primary);\n    color: var(--white);\n    border-color: var(--primary);\n  }\n  \n  .message-time {\n    font-size: var(--font-size-xs);\n    color: var(--gray-500);\n    margin-top: var(--spacing-1);\n  }\n  \n  .chat-warning {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-2);\n  }\n  \n  @media (max-width: 768px) {\n    .social-tabs {\n      flex-direction: column;\n    }\n    \n    .friend-item, .user-item, .invitation-item {\n      flex-direction: column;\n      text-align: center;\n    }\n    \n    .friend-actions, .user-actions, .invitation-actions {\n      width: 100%;\n      justify-content: center;\n    }\n    \n    .users-search {\n      flex-direction: column;\n    }\n    \n    .group-message {\n      max-width: 90%;\n    }\n  }\n",document.head.appendChild(socialStyles),document.addEventListener("DOMContentLoaded",(()=>{window.socialManager=new SocialManager})),console.log("Gestionnaire social initialisé");class StudyAIApp{constructor(){this.currentSection="dashboard",this.isInitialized=!1,this.managers={},this.init()}async init(){try{this.setupEventListeners(),this.initializeManagers(),await this.waitForAuth(),this.setupPeriodicTasks(),this.isInitialized=!0,console.log("Application StudyAI initialisée avec succès")}catch(e){console.error("Erreur lors de l'initialisation de l'application:",e)}}setupEventListeners(){document.querySelectorAll(".nav-item").forEach((e=>{e.addEventListener("click",(()=>{this.navigateTo(e.dataset.section)}))})),window.addEventListener("resize",(()=>{this.handleResize()})),document.addEventListener("visibilitychange",(()=>{this.handleVisibilityChange()})),this.setupNotificationPermissions(),window.addEventListener("beforeunload",(e=>{this.handleBeforeUnload(e)}))}initializeManagers(){this.managers={auth:window.authManager,dashboard:window.dashboardManager,courses:window.coursesManager,chat:window.chatManager,schedule:window.scheduleManager,social:window.socialManager,notifications:window.notificationManager}}async waitForAuth(){return new Promise((e=>{const n=()=>{window.authManager&&window.authManager.currentUser?e():setTimeout(n,100)};n()}))}navigateTo(e){if(this.currentSection===e)return;const n=document.getElementById(`${this.currentSection}-section`);n&&n.classList.remove("active");const t=document.querySelector(`.nav-item[data-section="${this.currentSection}"]`);t&&t.classList.remove("active");const s=document.getElementById(`${e}-section`);s&&s.classList.add("active");const a=document.querySelector(`.nav-item[data-section="${e}"]`);a&&a.classList.add("active"),this.currentSection=e,this.handleSectionChange(e),window.authManager?.saveToLocalStorage("currentSection",e)}handleSectionChange(e){switch(e){case"dashboard":this.managers.dashboard?.loadDashboard();break;case"courses":this.managers.courses?.loadCourses();break;case"chat":break;case"schedule":this.managers.schedule?.loadCurrentSchedule();break;case"social":this.managers.social?.loadSocialData();break;case"settings":this.loadSettings();break;case"exams":this.loadExams()}}loadSettings(){const e=document.getElementById("study-notifications"),n=document.getElementById("ai-suggestions"),t=(window.authManager?.getFromLocalStorage("userData")||{}).preferences||{};e&&(e.checked=!1!==t.studyReminders),n&&(n.checked=!1!==t.aiSuggestions),e?.addEventListener("change",(e=>{this.updatePreference("studyReminders",e.target.checked)})),n?.addEventListener("change",(e=>{this.updatePreference("aiSuggestions",e.target.checked)}))}async updatePreference(e,n){try{const t=window.authManager?.getFromLocalStorage("userData")||{};t.preferences=t.preferences||{},t.preferences[e]=n,window.authManager?.saveToLocalStorage("userData",t),window.authManager?.getCurrentUserId()&&await(window.FirebaseUtils?.saveUserData(window.authManager.getCurrentUserId(),t)),showNotification("Préférence mise à jour","success")}catch(e){console.error("Erreur lors de la mise à jour des préférences:",e),showNotification("Erreur lors de la mise à jour","error")}}loadExams(){const e=document.getElementById("exams-history"),n=window.authManager?.getFromLocalStorage("examResults")||[];if(0===n.length)return void(e.innerHTML='<p class="no-data">Aucun examen effectué</p>');const t=n.map((e=>`\n      <div class="exam-result-item">\n        <div class="exam-info">\n          <h4>${e.title}</h4>\n          <p>Date: ${new Date(e.date).toLocaleDateString("fr-FR")}</p>\n        </div>\n        <div class="exam-score">\n          <span class="score">${e.score}/${e.totalPoints}</span>\n          <span class="percentage">${e.percentage}%</span>\n        </div>\n      </div>\n    `)).join("");e.innerHTML=t}handleResize(){window.innerWidth<=768?this.enableMobileMode():this.disableMobileMode()}enableMobileMode(){document.body.classList.add("mobile-mode")}disableMobileMode(){document.body.classList.remove("mobile-mode")}handleVisibilityChange(){document.hidden?this.handlePageHidden():this.handlePageVisible()}handlePageHidden(){this.saveCurrentState()}handlePageVisible(){this.checkForUpdates()}saveCurrentState(){const e={currentSection:this.currentSection,timestamp:new Date,userActive:!0};window.authManager?.saveToLocalStorage("appState",e)}async checkForUpdates(){try{"dashboard"===this.currentSection&&await(this.managers.dashboard?.loadDashboard()),this.checkPendingNotifications()}catch(e){console.error("Erreur lors de la vérification des mises à jour:",e)}}checkPendingNotifications(){const e=window.authManager?.getFromLocalStorage("lastNotificationCheck"),n=new Date;(!e||n-new Date(e)>18e5)&&(this.managers.schedule?.updateSessionStates(),window.authManager?.saveToLocalStorage("last NotificationCheck",n))}setupNotificationPermissions(){"Notification"in window&&"default"===Notification.permission&&setTimeout((()=>{Notification.requestPermission().then((e=>{"granted"===e&&showNotification("Notifications activées ! Vous recevrez des rappels d'étude.","success")}))}),5e3)}setupPeriodicTasks(){setInterval((()=>{this.autoSave()}),3e5),setInterval((()=>{this.cleanupOldData()}),36e5),setInterval((()=>{this.checkUserActivity()}),6e5)}async autoSave(){try{if(!window.authManager?.getCurrentUserId())return;const e=window.authManager.getFromLocalStorage("userData");e&&(e.lastActivity=new Date,await(window.FirebaseUtils?.saveUserData(window.authManager.getCurrentUserId(),e)))}catch(e){console.error("Erreur lors de la sauvegarde automatique:",e)}}cleanupOldData(){try{this.managers.chat?.cleanupHistory();const e=window.authManager?.getFromLocalStorage("notifications")||[],n=new Date;n.setDate(n.getDate()-7);const t=e.filter((e=>new Date(e.timestamp)>n));window.authManager?.saveToLocalStorage("notifications",t)}catch(e){console.error("Erreur lors du nettoyage:",e)}}checkUserActivity(){const e=window.authManager?.getFromLocalStorage("userData");if(!e)return;const n=e.lastActivity?new Date(e.lastActivity):null,t=new Date;n&&t-n>72e5&&this.handleUserInactivity()}handleUserInactivity(){this.managers.notifications&&this.managers.notifications.show("Vous semblez absent. N'oubliez pas vos objectifs d'étude !","info",8e3)}handleBeforeUnload(e){this.saveCurrentState(),this.cleanup()}cleanup(){this.managers.schedule&&this.managers.schedule.scheduledNotifications.forEach((e=>{clearTimeout(e.timeoutId)}))}getCurrentSection(){return this.currentSection}isReady(){return this.isInitialized}getManager(e){return this.managers[e]}}function showMockExamModal(e){const n=document.createElement("div");n.className="modal active",n.style.display="flex",n.id="mock-exam-modal";const t=e.questions.map(((e,n)=>`\n    <div class="exam-question" data-question-index="${n}">\n      <div class="question-header">\n        <span class="question-number">Question ${n+1}</span>\n        <span class="question-points">${e.points} point(s)</span>\n      </div>\n      <div class="question-text">${e.question}</div>\n      ${"mcq"===e.type?`\n        <div class="question-options">\n          ${e.options.map(((e,t)=>`\n            <label class="option-item">\n              <input type="radio" name="exam_question_${n}" value="${t}">\n              <span>${e}</span>\n            </label>\n          `)).join("")}\n        </div>\n      `:`\n        <div class="boolean-options">\n          <label class="option-item">\n            <input type="radio" name="exam_question_${n}" value="true">\n            <span>Vrai</span>\n          </label>\n          <label class="option-item">\n            <input type="radio" name="exam_question_${n}" value="false">\n            <span>Faux</span>\n          </label>\n        </div>\n      `}\n    </div>\n  `)).join("");n.innerHTML=`\n    <div class="modal-content" style="max-width: 800px; max-height: 90vh;">\n      <div class="modal-header">\n        <h2>${e.title}</h2>\n        <div class="exam-info">\n          <span><i class="fas fa-clock"></i> ${e.duration} minutes</span>\n          <span><i class="fas fa-star"></i> ${e.totalPoints} points</span>\n        </div>\n        <button class="close-btn" onclick="closeMockExam()">\n          <i class="fas fa-times"></i>\n        </button>\n      </div>\n      <div class="modal-body" style="overflow-y: auto;">\n        <div class="exam-instructions">\n          <p><strong>Instructions:</strong> Répondez à toutes les questions. Vous avez ${e.duration} minutes.</p>\n        </div>\n        <div class="exam-questions">\n          ${t}\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button class="btn secondary" onclick="closeMockExam()">Annuler</button>\n        <button class="btn primary" onclick="submitMockExam()">\n          <i class="fas fa-check"></i>\n          Terminer l'examen\n        </button>\n      </div>\n    </div>\n  `,document.body.appendChild(n),window.currentMockExam=e}function showExamResults(e){const n=document.createElement("div");n.className="modal active",n.style.display="flex",n.innerHTML=`\n    <div class="modal-content">\n      <div class="modal-header">\n        <h2>Résultats de l'examen</h2>\n        <button class="close-btn" onclick="this.closest('.modal').remove()">\n          <i class="fas fa-times"></i>\n        </button>\n      </div>\n      <div class="modal-body">\n        <div class="exam-score-display">\n          <div class="score-circle">\n            <span class="score-value">${e.score}/${e.totalPoints}</span>\n            <span class="score-percentage">${e.percentage}%</span>\n          </div>\n        </div>\n        <div class="exam-advice">\n          <h3>Conseils personnalisés</h3>\n          <p>${e.advice}</p>\n        </div>\n        ${e.weakAreas.length>0?`\n          <div class="weak-areas">\n            <h3>Domaines à améliorer</h3>\n            <ul>\n              ${e.weakAreas.map((e=>`<li>${e}</li>`)).join("")}\n            </ul>\n          </div>\n        `:""}\n      </div>\n      <div class="modal-footer">\n        <button class="btn primary" onclick="this.closest('.modal').remove()">\n          <i class="fas fa-check"></i>\n          Compris\n        </button>\n      </div>\n    </div>\n  `,document.body.appendChild(n),e.percentage>=70?window.notificationManager?.celebrateSuccess(`Excellent ! ${e.percentage}% à l'examen !`):window.notificationManager?.show(`Score: ${e.percentage}% - Continuez vos efforts !`,"warning")}window.createMockExam=async function(){try{showLoading(!0);const e=window.coursesManager?.courses||[];if(0===e.length)return void showNotification("Ajoutez d'abord des cours pour créer un examen blanc","warning");const n=prompt("Quelle matière souhaitez-vous réviser ?")||"Général";showMockExamModal(await window.aiService.createMockExam(e,n))}catch(e){console.error("Erreur lors de la création de l'examen:",e),showNotification("Erreur lors de la création de l'examen","error")}finally{showLoading(!1)}},window.announceExam=async function(){const e=document.getElementById("exam-subject").value.trim(),n=document.getElementById("exam-date").value;if(!e||!n)return void showNotification("Veuillez remplir tous les champs","warning");const t=new Date(n),s=new Date;s.setDate(s.getDate()+1),t.toDateString()===s.toDateString()?(showNotification("Examen demain détecté ! Création d'un examen blanc...","info"),setTimeout((()=>{window.createMockExam()}),1e3)):showNotification(`Examen de ${e} programmé pour le ${t.toLocaleDateString("fr-FR")}`,"success")},window.closeMockExam=function(){const e=document.getElementById("mock-exam-modal");e&&e.remove(),window.currentMockExam=null},window.submitMockExam=async function(){if(!window.currentMockExam)return;const e=window.currentMockExam,n=[];if(e.questions.forEach(((e,t)=>{const s=document.querySelector(`input[name="exam_question_${t}"]:checked`);s&&("mcq"===e.type?n[t]=parseInt(s.value):n[t]="true"===s.value)})),n.length!==e.questions.length||n.includes(void 0))showNotification("Veuillez répondre à toutes les questions","warning");else try{showLoading(!0);const t=window.authManager?.getFromLocalStorage("userData")||{},s=await window.aiService.evaluateAndAdvise(n,e,t),a={...s,examTitle:e.title,date:new Date,answers:n},i=window.authManager?.getFromLocalStorage("examResults")||[];i.unshift(a),window.authManager?.saveToLocalStorage("examResults",i),window.closeMockExam(),showExamResults(s)}catch(e){console.error("Erreur lors de l'évaluation:",e),showNotification("Erreur lors de l'évaluation","error")}finally{showLoading(!1)}};const examStyles=document.createElement("style");examStyles.textContent="\n  .exam-announcement {\n    background: var(--white);\n    border-radius: var(--radius-lg);\n    box-shadow: var(--shadow);\n    padding: var(--spacing-6);\n    margin-bottom: var(--spacing-6);\n  }\n  \n  .exam-input {\n    display: flex;\n    gap: var(--spacing-3);\n    margin-top: var(--spacing-4);\n    flex-wrap: wrap;\n  }\n  \n  .exam-input input {\n    flex: 1;\n    min-width: 200px;\n    padding: var(--spacing-3);\n    border: 2px solid var(--gray-200);\n    border-radius: var(--radius);\n  }\n  \n  .exam-question {\n    background: var(--white);\n    border: 1px solid var(--gray-200);\n    border-radius: var(--radius);\n    padding: var(--spacing-4);\n    margin-bottom: var(--spacing-4);\n  }\n  \n  .question-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: var(--spacing-3);\n    padding-bottom: var(--spacing-2);\n    border-bottom: 1px solid var(--gray-200);\n  }\n  \n  .question-number {\n    font-weight: 600;\n    color: var(--primary);\n  }\n  \n  .question-points {\n    font-size: var(--font-size-sm);\n    color: var(--gray-600);\n  }\n  \n  .question-text {\n    font-weight: 600;\n    margin-bottom: var(--spacing-3);\n    line-height: 1.6;\n  }\n  \n  .exam-instructions {\n    background: var(--info);\n    background-opacity: 0.1;\n    border: 1px solid var(--info);\n    border-radius: var(--radius);\n    padding: var(--spacing-4);\n    margin-bottom: var(--spacing-4);\n    color: var(--info);\n  }\n  \n  .exam-info {\n    display: flex;\n    gap: var(--spacing-4);\n    font-size: var(--font-size-sm);\n    color: var(--gray-600);\n  }\n  \n  .exam-score-display {\n    text-align: center;\n    margin-bottom: var(--spacing-6);\n  }\n  \n  .score-circle {\n    display: inline-block;\n    padding: var(--spacing-6);\n    border-radius: var(--radius-full);\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: var(--white);\n    margin-bottom: var(--spacing-4);\n  }\n  \n  .score-value {\n    display: block;\n    font-size: var(--font-size-3xl);\n    font-weight: 700;\n    margin-bottom: var(--spacing-1);\n  }\n  \n  .score-percentage {\n    font-size: var(--font-size-lg);\n    opacity: 0.9;\n  }\n  \n  .exam-advice {\n    background: var(--gray-50);\n    border-radius: var(--radius);\n    padding: var(--spacing-4);\n    margin-bottom: var(--spacing-4);\n  }\n  \n  .weak-areas {\n    background: var(--warning);\n    background-opacity: 0.1;\n    border: 1px solid var(--warning);\n    border-radius: var(--radius);\n    padding: var(--spacing-4);\n  }\n  \n  .weak-areas ul {\n    margin: 0;\n    padding-left: var(--spacing-4);\n  }\n  \n  .exam-result-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: var(--spacing-4);\n    background: var(--white);\n    border-radius: var(--radius);\n    box-shadow: var(--shadow-sm);\n    margin-bottom: var(--spacing-3);\n  }\n  \n  .exam-score {\n    text-align: right;\n  }\n  \n  .exam-score .score {\n    display: block;\n    font-weight: 700;\n    font-size: var(--font-size-lg);\n    color: var(--primary);\n  }\n  \n  .exam-score .percentage {\n    font-size: var(--font-size-sm);\n    color: var(--gray-600);\n  }\n  \n  @media (max-width: 768px) {\n    .exam-input {\n      flex-direction: column;\n    }\n    \n    .exam-input input {\n      min-width: auto;\n    }\n    \n    .question-header {\n      flex-direction: column;\n      align-items: flex-start;\n      gap: var(--spacing-2);\n    }\n    \n    .exam-info {\n      flex-direction: column;\n      gap: var(--spacing-2);\n    }\n  }\n",document.head.appendChild(examStyles),document.addEventListener("DOMContentLoaded",(()=>{window.studyAIApp=new StudyAIApp})),console.log("Application StudyAI chargée")</script>
